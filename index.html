<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CyberWatch VN ‚Äî Aggregator An Ninh M·∫°ng</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&family=Exo+2:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg0:#050a0f; --bg1:#0a1520; --bg2:#0d1b2a; --bg2h:#112233;
  --a:#00f5c4; --a2:#ff3a3a; --a3:#f5a623; --a4:#4fc3f7;
  --t1:#e0f2fe; --t2:#7fb8d4; --tm:#3a6070;
  --bd:#1a3a50; --glow:0 0 18px #00f5c440; --glow2:0 0 18px #ff3a3a40;
  --mono:'Share Tech Mono',monospace; --dis:'Rajdhani',sans-serif; --body:'Exo 2',sans-serif;
}
[data-theme=light]{
  --bg0:#f0f4f8;--bg1:#e2eaf2;--bg2:#fff;--bg2h:#f8fafc;
  --a:#007a63;--a2:#cc0000;--a3:#b57a00;--a4:#0277bd;
  --t1:#0d1b2a;--t2:#2a5070;--tm:#7a9ab0;--bd:#c0d4e4;
  --glow:0 2px 12px #007a6330;--glow2:0 2px 12px #cc000030;
}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg0);color:var(--t1);font-family:var(--body);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,245,196,.012) 2px,rgba(0,245,196,.012) 4px);pointer-events:none;z-index:9999}
[data-theme=light] body::before{display:none}
.bg-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(0,245,196,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,245,196,.03) 1px,transparent 1px);background-size:50px 50px;pointer-events:none}
[data-theme=light] .bg-grid{background-image:linear-gradient(rgba(0,122,99,.05) 1px,transparent 1px),linear-gradient(90deg,rgba(0,122,99,.05) 1px,transparent 1px)}

/* NAV */
nav{position:sticky;top:0;z-index:200;background:rgba(5,10,15,.97);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd)}
[data-theme=light] nav{background:rgba(240,244,248,.97)}
.nav-inner{max-width:1500px;margin:0 auto;display:flex;align-items:center;gap:1rem;height:58px;padding:0 1.5rem}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;flex-shrink:0}
.logo-icon{width:34px;height:34px;border:2px solid var(--a);border-radius:6px;display:flex;align-items:center;justify-content:center;box-shadow:var(--glow);position:relative;overflow:hidden}
.logo-icon::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,transparent 40%,rgba(0,245,196,.2));animation:shimmer 3s ease-in-out infinite}
@keyframes shimmer{0%,100%{opacity:.5}50%{opacity:1}}
.logo-icon svg{width:18px;height:18px;fill:var(--a)}
.logo-txt{font-family:var(--dis);font-weight:700;font-size:1.15rem;letter-spacing:2px}
.logo-txt span{color:var(--a)}

/* TABS */
.nav-tabs{display:flex;gap:2px;margin-left:1rem}
.tab{font-family:var(--dis);font-weight:600;font-size:.78rem;letter-spacing:1.5px;text-transform:uppercase;padding:6px 14px;border-radius:4px;border:none;background:none;cursor:pointer;color:var(--tm);transition:all .2s}
.tab:hover{color:var(--t2);background:rgba(255,255,255,.05)}
.tab.active{color:var(--a);background:rgba(0,245,196,.08);box-shadow:inset 0 -2px var(--a)}

/* TICKER */
.ticker-wrap{flex:1;overflow:hidden;border:1px solid var(--bd);border-radius:4px;padding:3px 0;background:var(--bg1);font-family:var(--mono);font-size:.7rem}
.ticker{display:flex;white-space:nowrap;animation:tick 60s linear infinite}
.ticker:hover{animation-play-state:paused}
.ti{padding:0 1.5rem;color:var(--t2)}
.tc{color:var(--a2)}.th{color:var(--a3)}.tm2{color:var(--a4)}
@keyframes tick{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* TOOLBAR */
.toolbar{display:flex;align-items:center;gap:8px;flex-shrink:0}
.refresh-info{display:flex;align-items:center;gap:6px;font-family:var(--mono);font-size:.68rem;color:var(--tm)}
.rdot{width:6px;height:6px;border-radius:50%;background:var(--a);animation:pulse 2s ease infinite;flex-shrink:0}
.rdot.spin{background:var(--a3);border-radius:50% 50% 0 0;animation:spin 1s linear infinite}
.rdot.err{background:var(--a2);animation:blink 1s step-end infinite}
@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}
.cring{position:relative;width:26px;height:26px}
.cring svg{transform:rotate(-90deg)}
.ctrack{fill:none;stroke:var(--bd);stroke-width:3}
.cfill{fill:none;stroke:var(--a);stroke-width:3;stroke-linecap:round;transition:stroke-dashoffset 1s linear}
.cnum{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-size:.5rem;color:var(--a)}
.btn-sm{background:none;border:1px solid var(--bd);border-radius:5px;cursor:pointer;padding:5px 8px;color:var(--t2);font-size:.85rem;transition:all .2s}
.btn-sm:hover{border-color:var(--a);color:var(--a);box-shadow:var(--glow)}

/* MAIN */
.wrap{max-width:1500px;margin:0 auto;padding:1.25rem 1.5rem}

/* STATS */
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:.875rem;margin-bottom:1.25rem}
.sc{background:var(--bg2);border:1px solid var(--bd);border-radius:8px;padding:.875rem 1rem;display:flex;align-items:center;gap:.875rem;transition:all .3s;animation:fup .5s ease both;cursor:default}
.sc:hover{border-color:var(--a);box-shadow:var(--glow);transform:translateY(-2px)}
.sc:nth-child(1){animation-delay:.05s}.sc:nth-child(2){animation-delay:.1s}.sc:nth-child(3){animation-delay:.15s}.sc:nth-child(4){animation-delay:.2s}.sc:nth-child(5){animation-delay:.25s}
@keyframes fup{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.si{width:38px;height:38px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.sir{background:rgba(255,58,58,.12)}.sio{background:rgba(245,166,35,.12)}.sib{background:rgba(79,195,247,.12)}.sig{background:rgba(0,245,196,.12)}.sip{background:rgba(160,100,255,.12)}
.sv{font-family:var(--dis);font-size:1.5rem;font-weight:700;line-height:1}
.sl{font-size:.68rem;color:var(--tm);margin-top:2px;text-transform:uppercase;letter-spacing:1px}
.sbg{font-family:var(--mono);font-size:.62rem;padding:1px 7px;border-radius:20px;white-space:nowrap;margin-top:3px}
.sbr{background:rgba(255,58,58,.12);color:var(--a2)}.sbg2{background:rgba(0,245,196,.1);color:var(--a)}

/* SEARCH BAR */
.sbar{background:var(--bg2);border:1px solid var(--bd);border-radius:8px;padding:.875rem 1.1rem;margin-bottom:1.25rem;display:flex;gap:.875rem;align-items:center;flex-wrap:wrap}
.sbox{flex:1;min-width:200px;display:flex;align-items:center;gap:8px;background:var(--bg1);border:1px solid var(--bd);border-radius:6px;padding:6px 11px;transition:border-color .2s}
.sbox:focus-within{border-color:var(--a);box-shadow:var(--glow)}
.sbox input{flex:1;background:none;border:none;outline:none;color:var(--t1);font-family:var(--mono);font-size:.8rem}
.sbox input::placeholder{color:var(--tm)}
.fgrp{display:flex;gap:5px;flex-wrap:wrap}
.fb{font-family:var(--dis);font-weight:600;font-size:.72rem;letter-spacing:1px;padding:5px 11px;border-radius:4px;border:1px solid var(--bd);background:none;cursor:pointer;color:var(--t2);transition:all .2s;text-transform:uppercase}
.fb.active,.fb:hover{border-color:var(--a);color:var(--a);background:rgba(0,245,196,.06)}
.fb.fc.active{border-color:var(--a2);color:var(--a2);background:rgba(255,58,58,.06)}
.fb.fh.active{border-color:var(--a3);color:var(--a3);background:rgba(245,166,35,.06)}
.fb.fm.active{border-color:var(--a4);color:var(--a4);background:rgba(79,195,247,.06)}

/* SOURCE SELECTOR */
.src-pills{display:flex;gap:5px;flex-wrap:wrap}
.spill{font-family:var(--mono);font-size:.65rem;padding:4px 10px;border-radius:20px;border:1px solid var(--bd);background:none;cursor:pointer;color:var(--tm);transition:all .2s;display:flex;align-items:center;gap:5px}
.spill.on{border-color:var(--a4);color:var(--a4);background:rgba(79,195,247,.07)}
.spill .sdot2{width:4px;height:4px;border-radius:50%;background:currentColor}

/* GRID */
.main-grid{display:grid;grid-template-columns:1fr 340px;gap:1.25rem;align-items:start}

/* SECTION TITLE */
.stitle{font-family:var(--dis);font-weight:700;font-size:.78rem;letter-spacing:2px;text-transform:uppercase;color:var(--tm);display:flex;align-items:center;gap:8px;margin-bottom:.75rem}
.stitle::after{content:'';flex:1;height:1px;background:var(--bd)}
.livdot{width:5px;height:5px;border-radius:50%;background:var(--a);box-shadow:var(--glow);animation:pulse 2s ease infinite}

/* CVE TABLE */
.cve-box{background:var(--bg2);border:1px solid var(--bd);border-radius:8px;overflow:hidden;margin-bottom:1.25rem;animation:fup .5s .1s ease both}
.cve-hd{padding:.75rem 1.1rem;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--bd);gap:.75rem;flex-wrap:wrap}
.cve-hd h2{font-family:var(--dis);font-weight:700;font-size:.9rem;letter-spacing:1px}
.badges{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
.lbadge{font-family:var(--mono);font-size:.62rem;padding:2px 7px;border-radius:20px;background:rgba(255,58,58,.1);color:var(--a2);border:1px solid rgba(255,58,58,.22);display:flex;align-items:center;gap:4px}
.ldot{width:4px;height:4px;border-radius:50%;background:var(--a2);animation:blink 1s step-end infinite}
.nbadge{font-family:var(--mono);font-size:.6rem;padding:2px 7px;border-radius:3px;background:rgba(0,245,196,.08);color:var(--a);border:1px solid rgba(0,245,196,.18)}
table{width:100%;border-collapse:collapse}
thead th{font-family:var(--mono);font-size:.63rem;text-transform:uppercase;letter-spacing:1px;color:var(--tm);padding:7px .9rem;text-align:left;border-bottom:1px solid var(--bd);background:var(--bg1);white-space:nowrap}
tbody tr{border-bottom:1px solid rgba(26,58,80,.35);transition:background .15s;cursor:pointer}
tbody tr:hover{background:var(--bg2h)}
tbody tr:last-child{border-bottom:none}
tbody td{padding:9px .9rem;font-size:.8rem;vertical-align:middle}
.cid{font-family:var(--mono);font-size:.75rem;color:var(--a4);white-space:nowrap}
.sb{display:inline-flex;align-items:center;padding:2px 7px;border-radius:3px;font-family:var(--mono);font-size:.62rem;font-weight:600;letter-spacing:.5px;white-space:nowrap}
.sCRITICAL{background:rgba(255,58,58,.1);color:var(--a2);border:1px solid rgba(255,58,58,.22)}
.sHIGH{background:rgba(245,166,35,.1);color:var(--a3);border:1px solid rgba(245,166,35,.22)}
.sMEDIUM{background:rgba(79,195,247,.1);color:var(--a4);border:1px solid rgba(79,195,247,.22)}
.sLOW{background:rgba(0,245,196,.07);color:var(--a);border:1px solid rgba(0,245,196,.16)}
.sNONE{background:rgba(100,100,100,.1);color:#666;border:1px solid rgba(100,100,100,.2)}
.sbar2{display:flex;align-items:center;gap:5px}
.str{width:48px;height:3px;background:var(--bd);border-radius:2px;overflow:hidden}
.sf{height:100%;border-radius:2px}
.sn{font-family:var(--mono);font-size:.72rem;min-width:22px}
.ptag{font-size:.67rem;padding:1px 6px;background:var(--bg1);border:1px solid var(--bd);border-radius:3px;color:var(--t2);font-family:var(--mono);white-space:nowrap}
.tago{color:var(--tm);font-family:var(--mono);font-size:.67rem;white-space:nowrap}
.desc-c{max-width:200px;color:var(--t2);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.cve-ft{padding:.5rem .9rem;border-top:1px solid var(--bd);font-family:var(--mono);font-size:.62rem;color:var(--tm);display:flex;justify-content:space-between}
.ft-lnk{color:var(--a4);text-decoration:none}.ft-lnk:hover{text-decoration:underline}

/* NEWS TABS */
.news-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem;flex-wrap:wrap;gap:.5rem}
.ntabs{display:flex;gap:4px}
.ntab{font-family:var(--mono);font-size:.65rem;letter-spacing:1px;padding:4px 10px;border-radius:4px;border:1px solid var(--bd);background:none;cursor:pointer;color:var(--tm);transition:all .2s;text-transform:uppercase}
.ntab.active{border-color:var(--a4);color:var(--a4);background:rgba(79,195,247,.07)}

/* NEWS CARDS */
.news-grid{display:flex;flex-direction:column;gap:.75rem}
.nc{background:var(--bg2);border:1px solid var(--bd);border-left:3px solid var(--bd);border-radius:8px;padding:1rem 1.1rem;display:flex;gap:.875rem;transition:all .25s;cursor:pointer;position:relative;animation:fup .4s ease both}
.nc:hover{border-color:var(--a);border-left-color:var(--a);transform:translateX(3px)}
.nc.urg{border-left-color:var(--a2)}
.nc:hover.urg{border-left-color:var(--a2)}

/* Source favicon area */
.nc-src-icon{width:36px;height:36px;border-radius:6px;background:var(--bg1);border:1px solid var(--bd);display:flex;align-items:center;justify-content:center;font-size:1rem;flex-shrink:0;overflow:hidden}
.nc-src-icon img{width:100%;height:100%;object-fit:cover;border-radius:5px}
.nc-body{flex:1;min-width:0}
.nc-meta-top{display:flex;align-items:center;gap:6px;margin-bottom:4px;flex-wrap:wrap}
.src-name{font-family:var(--mono);font-size:.62rem;color:var(--a4)}
.nc-cat{font-family:var(--mono);font-size:.6rem;letter-spacing:1px;text-transform:uppercase;padding:1px 6px;border-radius:3px;border:1px solid currentColor}
.nc-title{font-family:var(--dis);font-weight:600;font-size:.9rem;line-height:1.4;color:var(--t1);margin-bottom:5px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.nc-summary{font-size:.75rem;color:var(--t2);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;margin-bottom:5px}
.nc-foot{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.nc-date{font-family:var(--mono);font-size:.62rem;color:var(--tm)}
.ntag{font-size:.6rem;padding:1px 6px;border-radius:3px;font-family:var(--mono);background:var(--bg1);color:var(--t2);border:1px solid var(--bd)}
.new-pill{font-family:var(--mono);font-size:.58rem;padding:1px 5px;border-radius:3px;background:rgba(0,245,196,.12);color:var(--a);border:1px solid rgba(0,245,196,.25)}
.urg-pill{font-family:var(--mono);font-size:.58rem;padding:1px 5px;border-radius:3px;background:rgba(255,58,58,.12);color:var(--a2);border:1px solid rgba(255,58,58,.25)}
.nc-ext{font-size:.65rem;color:var(--a4);text-decoration:none;font-family:var(--mono)}
.nc-ext:hover{text-decoration:underline}

/* No results */
.empty{padding:2.5rem;text-align:center;font-family:var(--mono);color:var(--tm)}
.empty .ei{font-size:2rem;margin-bottom:.5rem}

/* Skeleton */
.sk{background:linear-gradient(90deg,var(--bg1) 25%,var(--bg2h) 50%,var(--bg1) 75%);background-size:200% 100%;animation:sk 1.5s infinite;border-radius:5px}
@keyframes sk{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* SIDEBAR */
.sidebar{display:flex;flex-direction:column;gap:1.1rem}
.widget{background:var(--bg2);border:1px solid var(--bd);border-radius:8px;overflow:hidden;animation:fup .5s .15s ease both}
.wh{padding:.7rem 1rem;border-bottom:1px solid var(--bd);font-family:var(--dis);font-weight:700;font-size:.75rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--t2);display:flex;align-items:center;justify-content:space-between}

/* Gauge */
.gmeter{padding:1.1rem;text-align:center}
.gw{position:relative;display:inline-block;margin-bottom:.6rem}
.gsvg{width:140px;height:80px}
.gval{position:absolute;bottom:-3px;left:50%;transform:translateX(-50%);font-family:var(--dis);font-size:1.7rem;font-weight:800}
.glbl{font-family:var(--mono);font-size:.65rem;color:var(--tm);letter-spacing:1px}
.gstat{font-family:var(--dis);font-weight:700;font-size:.85rem;letter-spacing:2px;text-transform:uppercase;margin-top:2px}

/* Targets */
.tlist{padding:.25rem 0}
.ti2{padding:.55rem 1rem;display:flex;align-items:center;gap:7px;border-bottom:1px solid rgba(26,58,80,.25);transition:background .15s}
.ti2:last-child{border-bottom:none}
.ti2:hover{background:var(--bg2h)}
.trank{font-family:var(--mono);font-size:.6rem;color:var(--tm);width:14px;flex-shrink:0}
.tbw{flex:1}
.tname{font-size:.75rem;color:var(--t1);margin-bottom:2px}
.ttr{height:2px;background:var(--bd);border-radius:2px;overflow:hidden}
.tfill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--a4),var(--a))}
.tcnt{font-family:var(--mono);font-size:.65rem;color:var(--tm)}

/* Activity */
.afeed{max-height:240px;overflow-y:auto}
.afeed::-webkit-scrollbar{width:3px}
.afeed::-webkit-scrollbar-track{background:var(--bg1)}
.afeed::-webkit-scrollbar-thumb{background:var(--bd);border-radius:2px}
.aitem{padding:.55rem 1rem;display:flex;gap:7px;border-bottom:1px solid rgba(26,58,80,.2);font-size:.75rem}
.aitem:last-child{border-bottom:none}
.adot2{width:5px;height:5px;border-radius:50%;flex-shrink:0;margin-top:4px}
.atxt{color:var(--t2);line-height:1.4;flex:1}
.atxt strong{color:var(--t1)}
.atime{font-family:var(--mono);font-size:.6rem;color:var(--tm)}

/* Source status widget */
.src-status{padding:.5rem 0}
.ss-item{padding:.5rem 1rem;display:flex;align-items:center;gap:8px;border-bottom:1px solid rgba(26,58,80,.2);font-size:.75rem}
.ss-item:last-child{border-bottom:none}
.ss-dot{width:6px;height:6px;border-radius:50%;flex-shrink:0}
.ss-ok{background:var(--a);box-shadow:var(--glow)}
.ss-err{background:var(--a2)}
.ss-load{background:var(--a3);animation:pulse 1s ease infinite}
.ss-name{flex:1;color:var(--t2);font-family:var(--mono);font-size:.68rem}
.ss-cnt{font-family:var(--mono);font-size:.62rem;color:var(--tm)}

/* MODAL */
.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);z-index:1000;align-items:center;justify-content:center}
.mo.open{display:flex}
.md{background:var(--bg2);border:1px solid var(--bd);border-radius:10px;max-width:660px;width:94%;max-height:84vh;overflow-y:auto;padding:1.75rem;box-shadow:0 0 80px rgba(0,0,0,.7);animation:min .25s ease}
@keyframes min{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}
.mc{float:right;background:none;border:none;color:var(--tm);cursor:pointer;font-size:1.2rem;transition:color .2s;margin-left:1rem}
.mc:hover{color:var(--a2)}
.md h2{font-family:var(--dis);font-size:1.15rem;margin-bottom:.75rem;color:var(--t1)}
.md p{color:var(--t2);line-height:1.75;font-size:.85rem;margin-bottom:.75rem}
.dr{display:flex;gap:8px;margin-bottom:.35rem;font-size:.8rem}
.dl{color:var(--tm);font-family:var(--mono);min-width:110px;flex-shrink:0}
.dv{color:var(--t1);word-break:break-all}
.code{background:var(--bg1);border:1px solid var(--bd);border-radius:6px;padding:.75rem;font-family:var(--mono);font-size:.72rem;color:var(--a);overflow-x:auto;margin-top:.75rem;white-space:pre}
.wbox{margin-top:.75rem;padding:.65rem;background:rgba(255,58,58,.06);border:1px solid rgba(255,58,58,.18);border-radius:6px;color:var(--a2);font-size:.78rem}
.btn-src{display:inline-flex;align-items:center;gap:6px;margin-top:.75rem;padding:6px 14px;border-radius:5px;border:1px solid var(--a4);color:var(--a4);text-decoration:none;font-family:var(--mono);font-size:.72rem;transition:all .2s}
.btn-src:hover{background:rgba(79,195,247,.1)}

/* FOOTER */
footer{max-width:1500px;margin:2rem auto 0;padding:1rem 1.5rem;border-top:1px solid var(--bd);display:flex;justify-content:space-between;align-items:center;font-family:var(--mono);font-size:.65rem;color:var(--tm);flex-wrap:wrap;gap:.5rem}
.flo{color:var(--a)}

/* Responsive */
@media(max-width:1100px){.main-grid{grid-template-columns:1fr}.stats{grid-template-columns:repeat(3,1fr)}}
@media(max-width:768px){.stats{grid-template-columns:repeat(2,1fr)}.wrap{padding:1rem}.ticker-wrap{display:none}.nav-tabs{display:none}}
@media(max-width:480px){.stats{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="bg-grid"></div>

<nav>
  <div class="nav-inner">
    <a href="#" class="logo">
      <div class="logo-icon"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg></div>
      <span class="logo-txt">Cyber<span>Watch</span> VN</span>
    </a>
    <div class="nav-tabs">
      <button class="tab active" onclick="switchTab('dashboard',this)">Dashboard</button>
      <button class="tab" onclick="switchTab('news',this)">Tin t·ª©c</button>
      <button class="tab" onclick="switchTab('cve',this)">CVE</button>
    </div>
    <div class="ticker-wrap"><div class="ticker" id="ticker"><span class="ti">‚è≥ ƒêang k·∫øt n·ªëi t·ªõi c√°c ngu·ªìn RSS... </span><span class="ti">‚è≥ ƒêang k·∫øt n·ªëi t·ªõi c√°c ngu·ªìn RSS... </span></div></div>
    <div class="toolbar">
      <div class="refresh-info">
        <div class="rdot" id="rdot"></div>
        <span id="rlbl">Kh·ªüi ƒë·ªông...</span>
      </div>
      <div class="cring" title="C·∫≠p nh·∫≠t ti·∫øp theo">
        <svg width="26" height="26" viewBox="0 0 26 26">
          <circle class="ctrack" cx="13" cy="13" r="10"/>
          <circle class="cfill" id="ccirc" cx="13" cy="13" r="10" stroke-dasharray="62.8" stroke-dashoffset="0"/>
        </svg>
        <div class="cnum" id="cnum">5:00</div>
      </div>
      <button class="btn-sm" onclick="manualRefresh()" title="L√†m m·ªõi ngay">‚Ü∫</button>
      <button class="btn-sm" onclick="toggleTheme()" id="tbtn">‚òÄÔ∏è</button>
    </div>
  </div>
</nav>

<div class="wrap">

  <!-- STATS -->
  <div class="stats">
    <div class="sc"><div class="si sir">üõ°Ô∏è</div><div><div class="sv" id="stCVE">‚Äî</div><div class="sl">CVE tu·∫ßn n√†y</div><div class="sbg sbr" id="stCVEb">NVD LIVE</div></div></div>
    <div class="sc"><div class="si sio">üî¥</div><div><div class="sv" id="stCrit">‚Äî</div><div class="sl">Critical</div><div class="sbg sbr" id="stCritb">CVSS ‚â• 9</div></div></div>
    <div class="sc"><div class="si sib">üì∞</div><div><div class="sv" id="stNews">‚Äî</div><div class="sl">B√†i b√°o m·ªõi</div><div class="sbg sbg2" id="stNewsb">RSS LIVE</div></div></div>
    <div class="sc"><div class="si sig">üåê</div><div><div class="sv" id="stSrc">‚Äî</div><div class="sl">Ngu·ªìn ho·∫°t ƒë·ªông</div><div class="sbg sbg2" id="stSrcb">Feeds</div></div></div>
    <div class="sc"><div class="si sip">üïê</div><div><div class="sv" id="stTime">‚Äî</div><div class="sl">C·∫≠p nh·∫≠t l√∫c</div><div class="sbg sbg2">AUTO</div></div></div>
  </div>

  <!-- SEARCH -->
  <div class="sbar">
    <div class="sbox">
      <span style="color:var(--tm)">üîç</span>
      <input type="text" id="sinput" placeholder="T√¨m CVE, b√†i b√°o, ngu·ªìn, t·ª´ kh√≥a..." oninput="doSearch()">
    </div>
    <div class="fgrp" id="sevFilters" style="display:none">
      <button class="fb active" onclick="setFilter('ALL',this)">T·∫•t c·∫£</button>
      <button class="fb fc" onclick="setFilter('CRITICAL',this)">Critical</button>
      <button class="fb fh" onclick="setFilter('HIGH',this)">High</button>
      <button class="fb fm" onclick="setFilter('MEDIUM',this)">Medium</button>
      <button class="fb" onclick="setFilter('LOW',this)">Low</button>
    </div>
    <div class="src-pills" id="srcPills"></div>
  </div>

  <!-- GRID -->
  <div class="main-grid">
    <div>
      <!-- CVE TABLE -->
      <div id="cveSection">
        <div class="stitle"><div class="livdot"></div>B·∫£ng CVE ‚Äî NVD Real-time</div>
        <div class="cve-box">
          <div class="cve-hd">
            <h2>üî¥ L·ªó h·ªïng m·ªõi ph√°t hi·ªán</h2>
            <div class="badges">
              <span class="nbadge">nvd.nist.gov</span>
              <span class="lbadge"><span class="ldot"></span>LIVE ¬∑ 5 ph√∫t</span>
            </div>
          </div>
          <div id="cveContent"><div style="padding:2rem"><div class="sk" style="height:13px;margin-bottom:10px"></div><div class="sk" style="height:13px;margin-bottom:10px;width:80%"></div><div class="sk" style="height:13px;width:60%"></div></div></div>
          <div class="cve-ft"><span>Ngu·ªìn: <a href="https://nvd.nist.gov/developers/vulnerabilities" class="ft-lnk" target="_blank">NVD API v2.0</a> ¬∑ NIST</span><span id="cveCount">‚Äî</span></div>
        </div>
      </div>

      <!-- NEWS SECTION -->
      <div id="newsSection">
        <div class="news-top">
          <div class="stitle" style="margin:0;flex:1"><div class="livdot"></div>Tin t·ª©c an ninh m·∫°ng ‚Äî RSS Live</div>
          <div class="ntabs">
            <button class="ntab active" onclick="setNewsTab('all',this)">T·∫•t c·∫£</button>
            <button class="ntab" onclick="setNewsTab('APT',this)">APT</button>
            <button class="ntab" onclick="setNewsTab('Ransomware',this)">Ransomware</button>
            <button class="ntab" onclick="setNewsTab('Vulnerability',this)">Vuln</button>
          </div>
        </div>
        <div class="news-grid" id="newsList"><div class="sk" style="height:90px;border-radius:8px;margin-bottom:.75rem"></div><div class="sk" style="height:90px;border-radius:8px;margin-bottom:.75rem"></div><div class="sk" style="height:90px;border-radius:8px"></div></div>
        <div style="text-align:center;padding:1rem 0">
          <button class="btn-sm" id="loadMoreBtn" onclick="loadMore()" style="padding:7px 20px;font-family:var(--mono);font-size:.72rem">T·∫£i th√™m b√†i ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar">
      <!-- Threat -->
      <div class="widget">
        <div class="wh">‚ö° M·ª©c ƒëe d·ªça <span id="gdate" style="font-size:.58rem;color:var(--tm)"></span></div>
        <div class="gmeter">
          <div class="gw">
            <svg class="gsvg" viewBox="0 0 140 80">
              <path d="M12,70 A52,52 0 0,1 128,70" fill="none" stroke="#1a3a50" stroke-width="10" stroke-linecap="round"/>
              <path id="gfill" d="M12,70 A52,52 0 0,1 128,70" fill="none" stroke="url(#gg)" stroke-width="10" stroke-linecap="round" stroke-dasharray="163" stroke-dashoffset="41"/>
              <defs><linearGradient id="gg" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#00f5c4"/><stop offset="50%" stop-color="#f5a623"/><stop offset="100%" stop-color="#ff3a3a"/></linearGradient></defs>
            </svg>
            <div class="gval" id="gval" style="color:var(--a2)">‚Äî</div>
          </div>
          <div class="glbl">THREAT SCORE</div>
          <div class="gstat" id="gstat" style="color:var(--a2)">...</div>
        </div>
      </div>

      <!-- RSS Source Status -->
      <div class="widget">
        <div class="wh">üì° Tr·∫°ng th√°i ngu·ªìn RSS</div>
        <div class="src-status" id="srcStatus">
          <div style="padding:1rem"><div class="sk" style="height:11px;margin-bottom:8px"></div><div class="sk" style="height:11px;margin-bottom:8px;width:75%"></div><div class="sk" style="height:11px;width:55%"></div></div>
        </div>
      </div>

      <!-- Top Targets -->
      <div class="widget">
        <div class="wh">üéØ S·∫£n ph·∫©m b·ªã nh·∫Øm nhi·ªÅu nh·∫•t</div>
        <div class="tlist" id="tlist"><div style="padding:1rem"><div class="sk" style="height:11px;margin-bottom:8px"></div><div class="sk" style="height:11px;margin-bottom:8px;width:80%"></div><div class="sk" style="height:11px;width:60%"></div></div></div>
      </div>

      <!-- Activity -->
      <div class="widget">
        <div class="wh">üîî Ho·∫°t ƒë·ªông <span class="lbadge" style="font-size:.58rem"><span class="ldot"></span>LIVE</span></div>
        <div class="afeed" id="afeed"><div style="padding:1rem"><div class="sk" style="height:11px;margin-bottom:8px"></div><div class="sk" style="height:11px;margin-bottom:8px;width:75%"></div><div class="sk" style="height:11px;width:55%"></div></div></div>
      </div>
    </div>
  </div>
</div>

<footer>
  <span>¬© 2025 <span class="flo">CyberWatch VN</span> ‚Äî N·ªÅn t·∫£ng t·ªïng h·ª£p an ninh m·∫°ng</span>
  <span id="ftupdate">Ngu·ªìn: NVD ¬∑ THN ¬∑ BC ¬∑ Krebs ¬∑ CISA ¬∑ Dark Reading</span>
</footer>

<!-- MODAL -->
<div class="mo" id="mo" onclick="closeMod(event)"><div class="md"><button class="mc" onclick="closeMod()">‚úï</button><div id="mdbody"></div></div></div>

<script>

//  CONFIG & STATE

const REFRESH_SEC = 300; // 5 ph√∫t
const CIRC = 62.8;
const NEWS_PER_PAGE = 8;

const RSS_SOURCES = [
  { id:'thn',   name:'The Hacker News',   url:'https://feeds.feedburner.com/TheHackersNews', color:'#ff3a3a', icon:'üî¥', cat:'Vulnerability' },
  { id:'bc',    name:'BleepingComputer',  url:'https://www.bleepingcomputer.com/feed/', color:'#4fc3f7', icon:'üîµ', cat:'Malware' },
  { id:'krebs', name:'Krebs on Security', url:'https://krebsonsecurity.com/feed/', color:'#f5a623', icon:'üü†', cat:'APT' },
  { id:'cisa',  name:'CISA Alerts',       url:'https://www.cisa.gov/cybersecurity-advisories/all.xml', color:'#00f5c4', icon:'üü¢', cat:'Advisory' },
  { id:'dr',    name:'Dark Reading',      url:'https://www.darkreading.com/rss.xml', color:'#a064ff', icon:'üü£', cat:'Research' },
  { id:'sc',    name:'SC Magazine',       url:'https://www.scmagazine.com/rss', color:'#ff7a3a', icon:'üü†', cat:'Industry' },
];

let allCVEs = [];
let allNews = [];
let displayedNews = 0;
let currentFilter = 'ALL';
let currentSearch = '';
let currentNewsTab = 'all';
let activeSourceFilter = null; // null = all
let sourceStatus = {};
let actLog = [];
let secLeft = REFRESH_SEC;
let timer = null;
let currentTab = 'dashboard';

//CVE

async function fetchCVEs() {
  setStatus('spin','T·∫£i CVE t·ª´ NVD...');
  try {
    const startDate = new Date(); startDate.setDate(startDate.getDate()-7);
    const endDate = new Date();
    const fmt = d => d.toISOString().split('.')[0]+'.000';

    const r = await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      model:'claude-sonnet-4-20250514',max_tokens:4000,
      tools:[{type:'web_search_20250305',name:'web_search'}],
      messages:[{role:'user',content:`Search and fetch the latest CVE vulnerabilities from the NVD (National Vulnerability Database) API.

Use this endpoint: https://services.nvd.nist.gov/rest/json/cves/2.0?resultsPerPage=15&pubStartDate=${fmt(startDate)}&pubEndDate=${fmt(endDate)}

Parse the JSON response and return ONLY a raw JSON array (no markdown fences, no text before or after) with this structure:
[{"id":"CVE-YYYY-NNNNN","description":"English description max 120 chars","severity":"CRITICAL|HIGH|MEDIUM|LOW","score":9.8,"product":"Vendor ProductName","published":"ISO datetime","vector":"CVSS vector","references":["url"]}]

- severity/score from cvssMetricV31 or cvssMetricV30
- product from CPE configurations (first affected vendor+product)
- Return 10-15 items sorted by score descending
- Return ONLY the JSON array`}]})});

    const d = await r.json();
    const txt = d.content.filter(b=>b.type==='text').map(b=>b.text).join('');
    const m = txt.match(/\[[\s\S]*?\]/);
    if(m){const parsed=JSON.parse(m[0]);if(parsed.length){allCVEs=parsed;}}
    if(!allCVEs.length) throw new Error('empty');
  } catch(e) {
    allCVEs = getFallbackCVEs();
    logActivity('warn','D√πng CVE fallback (NVD t·∫°m th·ªùi kh√¥ng ph·∫£n h·ªìi)','V·ª´a xong');
  }
  renderCVETable();
  updateGauge();
  updateTargets();
  updateTicker();
  document.getElementById('stCVE').textContent = allCVEs.length;
  document.getElementById('stCrit').textContent = allCVEs.filter(c=>c.severity==='CRITICAL').length;
}

//  FETCH NEWS via Claude AI + RSS Web Search

async function fetchAllNews() {
  setStatus('spin','T·∫£i tin t·ª©c t·ª´ RSS...');
  logActivity('info','K·∫øt n·ªëi t·ªõi c√°c ngu·ªìn RSS...','V·ª´a xong');

  // Render source status loading
  renderSourceStatus('loading');

  try {
    const today = new Date().toISOString().split('T')[0];
    const sources = RSS_SOURCES.map(s=>s.name).join(', ');

    const r = await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({
      model:'claude-sonnet-4-20250514',max_tokens:5000,
      tools:[{type:'web_search_20250305',name:'web_search'}],
      messages:[{role:'user',content:`Search for the LATEST cybersecurity news articles published TODAY or in the last 48 hours (today: ${today}).

Search from these specific sources: ${sources}
Also search: site:thehackernews.com OR site:bleepingcomputer.com OR site:krebsonsecurity.com OR site:darkreading.com OR site:cisa.gov cybersecurity 2025

Return ONLY a raw JSON array (no markdown, no text outside JSON):
[
  {
    "id": 1,
    "source": "The Hacker News",
    "sourceId": "thn",
    "category": "APT|Ransomware|Vulnerability|Malware|Phishing|Advisory|Research|Supply Chain",
    "categoryColor": "#ff3a3a",
    "title": "Original English title OR Vietnamese translation",
    "titleEn": "Original English title",
    "summary": "2-3 sentence summary in Vietnamese explaining what happened and why it matters",
    "url": "direct article URL",
    "date": "DD/MM/YYYY HH:MM",
    "dateISO": "ISO datetime",
    "tags": ["tag1","tag2","tag3"],
    "urgent": true/false,
    "tldr": "One line Vietnamese summary max 80 chars"
  }
]

Category colors: APT=#ff3a3a, Ransomware=#f5a623, Vulnerability=#4fc3f7, Malware=#00f5c4, Phishing=#ff3a3a, Advisory=#00f5c4, Research=#a064ff, Supply Chain=#f5a623
urgent=true if: zero-day, actively exploited, critical infrastructure, ransomware attack, nation-state
Return 12-16 unique articles from DIFFERENT sources, sorted by date descending.
Return ONLY the JSON array.`}]})});

    const d = await r.json();
    const txt = d.content.filter(b=>b.type==='text').map(b=>b.text).join('');
    const m = txt.match(/\[[\s\S]*\]/);
    if(m){
      try{
        const parsed = JSON.parse(m[0]);
        if(parsed.length){
          allNews = parsed;
          // Mark sources as OK based on which sourceIds appeared
          const foundIds = [...new Set(parsed.map(n=>n.sourceId).filter(Boolean))];
          RSS_SOURCES.forEach(s=>{sourceStatus[s.id]=foundIds.includes(s.id)?'ok':'err';});
          logActivity('ok',`T·∫£i th√†nh c√¥ng ${parsed.length} b√†i b√°o t·ª´ ${foundIds.length} ngu·ªìn RSS`,'V·ª´a xong');
        }
      }catch(e){}
    }
    if(!allNews.length) throw new Error('no news');
  } catch(e) {
    allNews = getFallbackNews();
    RSS_SOURCES.forEach(s=>{sourceStatus[s.id]='err';});
    logActivity('warn','D√πng d·ªØ li·ªáu m·∫´u (RSS t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng)','V·ª´a xong');
  }

  displayedNews = NEWS_PER_PAGE;
  renderSourceStatus('done');
  renderNews();
  renderSourcePills();
  document.getElementById('stNews').textContent = allNews.length;
  const okSrcs = Object.values(sourceStatus).filter(v=>v==='ok').length;
  document.getElementById('stSrc').textContent = okSrcs || RSS_SOURCES.length;
  document.getElementById('stTime').textContent = new Date().toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'});
  document.getElementById('ftupdate').textContent = `C·∫≠p nh·∫≠t: ${new Date().toLocaleString('vi-VN')} ¬∑ ${allNews.length} b√†i ¬∑ ${allCVEs.length} CVE`;
  setStatus('ok',`Xong l√∫c ${new Date().toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'})}`);
}

//  RENDER CVE

function renderCVETable(){
  let data = allCVEs;
  if(currentFilter!=='ALL') data=data.filter(c=>c.severity===currentFilter);
  if(currentSearch) data=data.filter(c=>
    (c.id||'').toLowerCase().includes(currentSearch)||
    (c.description||'').toLowerCase().includes(currentSearch)||
    (c.product||'').toLowerCase().includes(currentSearch));
  document.getElementById('cveCount').textContent=`${data.length} l·ªó h·ªïng`;
  if(!data.length){document.getElementById('cveContent').innerHTML=`<div class="empty"><div class="ei">üîç</div><p>Kh√¥ng t√¨m th·∫•y CVE ph√π h·ª£p</p></div>`;return;}
  const rows=data.map(c=>{
    const sc=parseFloat(c.score)||0,pct=(sc/10*100).toFixed(0);
    const col=sc>=9?'var(--a2)':sc>=7?'var(--a3)':sc>=4?'var(--a4)':'var(--a)';
    const sv=c.severity||sevFromScore(sc);
    const desc=(c.description||'').substring(0,60)+((c.description||'').length>60?'...':'');
    const ago=c.published?timeAgo(c.published):'‚Äî';
    const isNew=c.published&&(Date.now()-new Date(c.published).getTime())<24*3600000;
    const cs=encodeURIComponent(JSON.stringify(c));
    return `<tr onclick='openCVEModal(decodeURIComponent("${cs}"))'>
      <td><span class="cid">${c.id||'‚Äî'}</span>${isNew?'<span style="font-family:var(--mono);font-size:.58rem;color:var(--a);margin-left:4px">üÜï</span>':''}</td>
      <td class="desc-c" title="${c.description||''}">${desc}</td>
      <td><span class="sb s${sv}">${sv}</span></td>
      <td><div class="sbar2"><div class="str"><div class="sf" style="width:${pct}%;background:${col}"></div></div><span class="sn" style="color:${col}">${sc.toFixed(1)}</span></div></td>
      <td><span class="ptag">${(c.product||'Unknown').substring(0,18)}</span></td>
      <td><span class="tago">${ago}</span></td>
    </tr>`;}).join('');
  document.getElementById('cveContent').innerHTML=`<table><thead><tr><th>CVE ID</th><th>M√¥ t·∫£</th><th>M·ª©c ƒë·ªô</th><th>CVSS</th><th>S·∫£n ph·∫©m</th><th>Th·ªùi gian</th></tr></thead><tbody>${rows}</tbody></table>`;
}

//  RENDER NEWS

function renderNews(){
  let data = allNews;
  if(currentNewsTab!=='all') data=data.filter(n=>(n.category||'').toLowerCase()===currentNewsTab.toLowerCase());
  if(activeSourceFilter) data=data.filter(n=>n.sourceId===activeSourceFilter);
  if(currentSearch) data=data.filter(n=>
    (n.title||'').toLowerCase().includes(currentSearch)||
    (n.summary||'').toLowerCase().includes(currentSearch)||
    (n.source||'').toLowerCase().includes(currentSearch)||
    (n.tags||[]).some(t=>t.toLowerCase().includes(currentSearch)));

  const show = data.slice(0, displayedNews);
  document.getElementById('loadMoreBtn').style.display = data.length > displayedNews ? '' : 'none';

  if(!show.length){
    document.getElementById('newsList').innerHTML=`<div class="empty"><div class="ei">üì∞</div><p>Kh√¥ng c√≥ b√†i b√°o ph√π h·ª£p</p></div>`;
    return;
  }

  document.getElementById('newsList').innerHTML=show.map((n,i)=>{
    const src=RSS_SOURCES.find(s=>s.id===n.sourceId)||{icon:'üì∞',color:'#4fc3f7',name:n.source};
    const isNew=n.dateISO&&(Date.now()-new Date(n.dateISO).getTime())<3*3600000;
    const urlEncoded=encodeURIComponent(JSON.stringify(n));
    return `<div class="nc ${n.urgent?'urg':''}" style="animation-delay:${i*.05}s" onclick="openNewsModal(decodeURIComponent('${urlEncoded}'))">
      <div class="nc-src-icon" style="border-color:${src.color}40">${src.icon}</div>
      <div class="nc-body">
        <div class="nc-meta-top">
          <span class="src-name" style="color:${src.color}">${n.source||src.name}</span>
          <span class="nc-cat" style="color:${src.color};border-color:${src.color}60">${n.category}</span>
          ${isNew?'<span class="new-pill">üÜï M·ªõi</span>':''}
          ${n.urgent?'<span class="urg-pill">‚ö° Kh·∫©n</span>':''}
        </div>
        <div class="nc-title">${n.title}</div>
        <div class="nc-summary">${n.summary||n.tldr||''}</div>
        <div class="nc-foot">
          <span class="nc-date">üïê ${n.date||'‚Äî'}</span>
          ${(n.tags||[]).slice(0,3).map(t=>`<span class="ntag">${t}</span>`).join('')}
          ${n.url?`<a class="nc-ext" href="${n.url}" target="_blank" onclick="event.stopPropagation()">‚Üó ƒê·ªçc g·ªëc</a>`:''}
        </div>
      </div>
    </div>`;}).join('');
}

function loadMore(){
  displayedNews += NEWS_PER_PAGE;
  renderNews();
}

//  SOURCE STATUS WIDGET

function renderSourceStatus(state){
  if(state==='loading'){
    document.getElementById('srcStatus').innerHTML=`<div style="padding:1rem"><div class="sk" style="height:11px;margin-bottom:8px"></div><div class="sk" style="height:11px;margin-bottom:8px;width:75%"></div><div class="sk" style="height:11px;width:55%"></div></div>`;
    return;
  }
  const newsBySource={};
  allNews.forEach(n=>{if(n.sourceId)newsBySource[n.sourceId]=(newsBySource[n.sourceId]||0)+1;});
  document.getElementById('srcStatus').innerHTML=RSS_SOURCES.map(s=>{
    const st=sourceStatus[s.id]||'load';
    const dotCls=st==='ok'?'ss-ok':st==='err'?'ss-err':'ss-load';
    const cnt=newsBySource[s.id]||0;
    const label=st==='ok'?`${cnt} b√†i`:st==='err'?'L·ªói':'T·∫£i...';
    return `<div class="ss-item">
      <div class="ss-dot ${dotCls}"></div>
      <span class="ss-name">${s.icon} ${s.name}</span>
      <span class="ss-cnt">${label}</span>
    </div>`;}).join('');
}

//  SOURCE PILLS FILTER

function renderSourcePills(){
  const newsBySrc={};
  allNews.forEach(n=>{if(n.sourceId)newsBySrc[n.sourceId]=(newsBySrc[n.sourceId]||0)+1;});
  const pills=RSS_SOURCES.filter(s=>newsBySrc[s.id]).map(s=>`
    <button class="spill ${activeSourceFilter===s.id?'on':''}" onclick="toggleSrc('${s.id}',this)">
      <span class="sdot2"></span>${s.name} (${newsBySrc[s.id]})
    </button>`).join('');
  document.getElementById('srcPills').innerHTML=pills;
}

function toggleSrc(id){
  activeSourceFilter = activeSourceFilter===id ? null : id;
  renderSourcePills();
  displayedNews=NEWS_PER_PAGE;
  renderNews();
}

//  TICKER update

function updateTicker(){
  const cveItems=allCVEs.slice(0,5).map(c=>{
    const sv=c.severity||'MEDIUM';
    const cls=sv==='CRITICAL'?'tc':sv==='HIGH'?'th':'tm2';
    const em=sv==='CRITICAL'?'üî¥':sv==='HIGH'?'üü†':'üü°';
    return `<span class="ti">${em} <span class="${cls}">[${sv}]</span> ${c.id} ‚Äî ${(c.description||'').substring(0,55)} ¬∑ </span>`;});
  const newsItems=allNews.slice(0,5).map(n=>{
    const src=RSS_SOURCES.find(s=>s.id===n.sourceId)||{icon:'üì∞'};
    return `<span class="ti">${src.icon} ${n.source}: ${(n.title||'').substring(0,60)} ¬∑ </span>`;});
  const combined=[...cveItems,...newsItems];
  const doubled=[...combined,...combined].join('');
  document.getElementById('ticker').innerHTML=doubled||'<span class="ti">ƒêang t·∫£i d·ªØ li·ªáu...</span>';
}

//  GAUGE

function updateGauge(){
  const crit=allCVEs.filter(c=>c.severity==='CRITICAL').length;
  const high=allCVEs.filter(c=>c.severity==='HIGH').length;
  const urgNews=allNews.filter(n=>n.urgent).length;
  const score=Math.min(100,Math.round(crit*7+high*3+urgNews*2));
  const col=score>=70?'var(--a2)':score>=40?'var(--a3)':'var(--a)';
  const lbl=score>=70?'‚ö† CAO':score>=40?'‚ñ≤ TRUNG B√åNH':'‚úì TH·∫§P';
  const off=163-(score/100*163);
  document.getElementById('gval').textContent=score;
  document.getElementById('gval').style.color=col;
  document.getElementById('gstat').textContent=lbl;
  document.getElementById('gstat').style.color=col;
  document.getElementById('gfill').setAttribute('stroke-dashoffset',off);
  document.getElementById('gdate').textContent=new Date().toLocaleDateString('vi-VN');
}


//  TARGETS

function updateTargets(){
  const c={};
  allCVEs.forEach(v=>{const p=(v.product||'Unknown').split(' ').slice(0,2).join(' ');c[p]=(c[p]||0)+1;});
  const sorted=Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const max=sorted[0]?.[1]||1;
  document.getElementById('tlist').innerHTML=sorted.map(([n,cnt],i)=>`
    <div class="ti2">
      <div class="trank">0${i+1}</div>
      <div class="tbw"><div class="tname">${n}</div><div class="ttr"><div class="tfill" style="width:${(cnt/max*100).toFixed(0)}%"></div></div></div>
      <div class="tcnt">${cnt}</div>
    </div>`).join('');
}

//  ACTIVITY

function logActivity(type,text,time){
  const cols={ok:'#00f5c4',warn:'#f5a623',err:'#ff3a3a',info:'#4fc3f7'};
  actLog.unshift({dot:cols[type]||'#4fc3f7',text,time});
  if(actLog.length>15)actLog.pop();
  document.getElementById('afeed').innerHTML=actLog.map(a=>`
    <div class="aitem"><div class="adot2" style="background:${a.dot}"></div><div><div class="atxt">${a.text}</div><div class="atime">${a.time}</div></div></div>`).join('');
}

//  MODALS

function openCVEModal(cStr){
  let c;
  try{c=JSON.parse(cStr);}catch(e){return;}
  const sc=parseFloat(c.score)||0,sv=c.severity||sevFromScore(sc);
  const col=sc>=9?'var(--a2)':sc>=7?'var(--a3)':sc>=4?'var(--a4)':'var(--a)';
  document.getElementById('mdbody').innerHTML=`
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:.75rem;flex-wrap:wrap">
      <h2 style="margin:0">${c.id}</h2><span class="sb s${sv}">${sv}</span>
    </div>
    <p>${c.description||'Kh√¥ng c√≥ m√¥ t·∫£.'}</p>
    <div class="dr"><span class="dl">S·∫£n ph·∫©m:</span><span class="dv">${c.product||'‚Äî'}</span></div>
    <div class="dr"><span class="dl">CVSS Score:</span><span class="dv" style="color:${col};font-weight:700">${sc.toFixed(1)} / 10.0</span></div>
    <div class="dr"><span class="dl">Vector:</span><span class="dv" style="font-family:var(--mono);font-size:.7rem">${c.vector||'‚Äî'}</span></div>
    <div class="dr"><span class="dl">C√¥ng b·ªë:</span><span class="dv">${c.published?new Date(c.published).toLocaleString('vi-VN'):'‚Äî'}</span></div>
    ${(c.references||[]).length?`<div class="dr"><span class="dl">Tham kh·∫£o:</span><a href="${c.references[0]}" target="_blank" style="color:var(--a4);font-family:var(--mono);font-size:.7rem;word-break:break-all">${c.references[0]}</a></div>`:''}
    <div class="code">https://nvd.nist.gov/vuln/detail/${c.id}</div>
    <div class="wbox">‚ö†Ô∏è <strong>Khuy·∫øn ngh·ªã:</strong> C·∫≠p nh·∫≠t ngay l√™n phi√™n b·∫£n ƒë∆∞·ª£c v√°. Ki·ªÉm tra advisory t·ª´ nh√† cung c·∫•p.</div>`;
  document.getElementById('mo').classList.add('open');
}

function openNewsModal(nStr){
  let n;
  try{n=JSON.parse(nStr);}catch(e){return;}
  const src=RSS_SOURCES.find(s=>s.id===n.sourceId)||{color:'#4fc3f7',icon:'üì∞',name:n.source};
  document.getElementById('mdbody').innerHTML=`
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:.5rem">
      <span style="font-size:1.2rem">${src.icon}</span>
      <span style="font-family:var(--mono);font-size:.65rem;color:${src.color}">${n.source||src.name}</span>
      <span class="sb" style="color:${n.categoryColor||'#4fc3f7'};border:1px solid ${n.categoryColor||'#4fc3f7'}60;padding:1px 7px;font-size:.6rem">${n.category}</span>
      ${n.urgent?'<span class="urg-pill">‚ö° Kh·∫©n</span>':''}
    </div>
    <h2>${n.title}</h2>
    <p style="font-size:.82rem;background:rgba(0,245,196,.05);border-left:2px solid var(--a);padding:.75rem;border-radius:0 6px 6px 0;margin-bottom:.875rem"><strong>TL;DR:</strong> ${n.tldr||n.summary||'‚Äî'}</p>
    <p>${n.summary||'Kh√¥ng c√≥ t√≥m t·∫Øt.'}</p>
    <div class="dr"><span class="dl">Ng√†y ƒëƒÉng:</span><span class="dv">${n.date||'‚Äî'}</span></div>
    <div class="dr"><span class="dl">Ngu·ªìn:</span><span class="dv">${n.source||'‚Äî'}</span></div>
    <div style="margin-top:.75rem">${(n.tags||[]).map(t=>`<span class="ntag" style="margin-right:5px">${t}</span>`).join('')}</div>
    ${n.url?`<a class="btn-src" href="${n.url}" target="_blank">‚Üó ƒê·ªçc b√†i g·ªëc t·∫°i ${n.source}</a>`:''}`;
  document.getElementById('mo').classList.add('open');
}

function closeMod(e){if(!e||e.target===document.getElementById('mo'))document.getElementById('mo').classList.remove('open');}

//  FILTERS & SEARCH

function setFilter(f,btn){
  currentFilter=f;
  document.querySelectorAll('.fb').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  renderCVETable();
}

function setNewsTab(t,btn){
  currentNewsTab=t;
  document.querySelectorAll('.ntab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  displayedNews=NEWS_PER_PAGE;
  renderNews();
}

function doSearch(){
  currentSearch=document.getElementById('sinput').value.toLowerCase().trim();
  renderCVETable();
  displayedNews=NEWS_PER_PAGE;
  renderNews();
}

function switchTab(tab,btn){
  currentTab=tab;
  document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const sevF=document.getElementById('sevFilters');
  if(tab==='cve'){
    document.getElementById('cveSection').style.display='';
    document.getElementById('newsSection').style.display='none';
    sevF.style.display='';
  } else if(tab==='news'){
    document.getElementById('cveSection').style.display='none';
    document.getElementById('newsSection').style.display='';
    sevF.style.display='none';
  } else {
    document.getElementById('cveSection').style.display='';
    document.getElementById('newsSection').style.display='';
    sevF.style.display='none';
  }
}

//  COUNTDOWN

function startCountdown(){
  secLeft=REFRESH_SEC;
  if(timer)clearInterval(timer);
  timer=setInterval(()=>{
    secLeft--;
    const m=Math.floor(secLeft/60),s=secLeft%60;
    document.getElementById('cnum').textContent=`${m}:${s.toString().padStart(2,'0')}`;
    const off=CIRC-(secLeft/REFRESH_SEC*CIRC);
    document.getElementById('ccirc').setAttribute('stroke-dashoffset',off);
    if(secLeft<=0){
      clearInterval(timer);
      logActivity('info','Auto-refresh: t·∫£i l·∫°i d·ªØ li·ªáu...','V·ª´a xong');
      refreshAll();
    }
  },1000);
}

async function refreshAll(){
  await Promise.all([fetchCVEs(), fetchAllNews()]);
  updateGauge();
  updateTicker();
  startCountdown();
}

function manualRefresh(){
  if(timer)clearInterval(timer);
  logActivity('info','L√†m m·ªõi th·ªß c√¥ng...','V·ª´a xong');
  refreshAll();
}

//  THEME

function toggleTheme(){
  const h=document.documentElement;
  const d=h.dataset.theme==='dark';
  h.dataset.theme=d?'light':'dark';
  document.getElementById('tbtn').textContent=d?'üåô':'‚òÄÔ∏è';
}


//  STATUS HELPERS

function setStatus(state,lbl){
  const d=document.getElementById('rdot'),l=document.getElementById('rlbl');
  d.className='rdot'+(state==='spin'?' spin':state==='err'?' err':'');
  l.textContent=lbl;
}
function sevFromScore(s){if(s>=9)return'CRITICAL';if(s>=7)return'HIGH';if(s>=4)return'MEDIUM';if(s>0)return'LOW';return'NONE';}
function timeAgo(ds){const h=Math.floor((Date.now()-new Date(ds).getTime())/3600000),d=Math.floor(h/24);return d>0?`${d} ng√†y tr∆∞·ªõc`:h>0?`${h} gi·ªù tr∆∞·ªõc`:'V·ª´a xong';}


//  FALLBACK DATA

function getFallbackCVEs(){
  const n=new Date();const mk=h=>{const d=new Date(n);d.setHours(d.getHours()-h);return d.toISOString();};
  return [
    {id:'CVE-2025-21298',description:'Windows OLE Remote Code Execution via malicious email attachment',severity:'CRITICAL',score:9.8,product:'Microsoft Windows',published:mk(3),vector:'AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H',references:['https://msrc.microsoft.com']},
    {id:'CVE-2025-0282',description:'Ivanti Connect Secure stack-based buffer overflow allows unauthenticated RCE',severity:'CRITICAL',score:9.0,product:'Ivanti Connect Secure',published:mk(8),vector:'AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H',references:['https://www.ivanti.com']},
    {id:'CVE-2025-20156',description:'Cisco Meeting Management REST API privilege escalation to Administrator',severity:'CRITICAL',score:9.9,product:'Cisco Meeting Management',published:mk(20),vector:'AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H',references:['https://sec.cloudapps.cisco.com']},
    {id:'CVE-2025-23006',description:'SonicWall SMA 100 pre-authentication deserialization leading to RCE',severity:'CRITICAL',score:9.8,product:'SonicWall SMA',published:mk(30),vector:'AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H',references:['https://www.sonicwall.com']},
    {id:'CVE-2025-21333',description:'Windows Hyper-V NT Kernel Integration VSP Elevation of Privilege',severity:'HIGH',score:8.8,product:'Microsoft Hyper-V',published:mk(12),vector:'AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H',references:['https://msrc.microsoft.com']},
    {id:'CVE-2025-1094',description:'PostgreSQL quoting APIs fail with invalid multibyte chars allowing SQL injection',severity:'HIGH',score:8.1,product:'PostgreSQL',published:mk(36),vector:'AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H',references:['https://www.postgresql.org']},
    {id:'CVE-2025-21354',description:'Microsoft Excel Remote Code Execution via malicious spreadsheet',severity:'HIGH',score:7.8,product:'Microsoft Excel',published:mk(48),vector:'AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H',references:['https://msrc.microsoft.com']},
    {id:'CVE-2025-21293',description:'Active Directory Domain Services Elevation of Privilege Vulnerability',severity:'HIGH',score:8.8,product:'Microsoft Active Directory',published:mk(60),vector:'AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H',references:['https://msrc.microsoft.com']},
    {id:'CVE-2025-21374',description:'Windows CSC Service Information Disclosure Vulnerability',severity:'MEDIUM',score:5.5,product:'Microsoft Windows CSC',published:mk(72),vector:'AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N',references:['https://msrc.microsoft.com']},
    {id:'CVE-2025-21420',description:'Windows Disk Cleanup Tool Elevation of Privilege',severity:'HIGH',score:7.8,product:'Microsoft Windows',published:mk(80),vector:'AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H',references:['https://msrc.microsoft.com']},
  ];
}

function getFallbackNews(){
  const d=new Date().toLocaleDateString('vi-VN');
  const iso=new Date().toISOString();
  return [
    {id:1,source:'The Hacker News',sourceId:'thn',category:'APT',categoryColor:'#ff3a3a',title:'Salt Typhoon ti·∫øp t·ª•c x√¢m ph·∫°m nh√† cung c·∫•p vi·ªÖn th√¥ng M·ªπ sau nhi·ªÅu th√°ng',titleEn:'Salt Typhoon Continues to Compromise US Telecom Providers',summary:'Nh√≥m APT Salt Typhoon do nh√† n∆∞·ªõc Trung Qu·ªëc h·ªó tr·ª£ ƒë√£ x√¢m ph·∫°m √≠t nh·∫•t 9 nh√† cung c·∫•p vi·ªÖn th√¥ng l·ªõn c·ªßa M·ªπ. CISA v√† FBI ƒë√£ c√πng ph√°t h√†nh h∆∞·ªõng d·∫´n b·∫£o m·∫≠t kh·∫©n c·∫•p.',url:'https://thehackernews.com',date:d,dateISO:iso,tags:['APT','China','Telecom'],urgent:true,tldr:'Salt Typhoon x√¢m ph·∫°m 9+ nh√† m·∫°ng M·ªπ'},
    {id:2,source:'BleepingComputer',sourceId:'bc',category:'Ransomware',categoryColor:'#f5a623',title:'Clop ransomware t·∫•n c√¥ng ph·∫ßn m·ªÅm chuy·ªÉn file Cleo b·∫±ng zero-day m·ªõi',titleEn:'Clop ransomware exploits Cleo file transfer zero-day vulnerabilities',summary:'Nh√≥m Clop ƒëang khai th√°c l·ªó h·ªïng zero-day trong ph·∫ßn m·ªÅm Cleo Harmony, VLTrader v√† LexiCom, ·∫£nh h∆∞·ªüng ƒë·∫øn h√†ng ch·ª•c doanh nghi·ªáp tr√™n to√†n th·∫ø gi·ªõi.',url:'https://www.bleepingcomputer.com',date:d,dateISO:iso,tags:['Ransomware','Zero-day','Clop'],urgent:true,tldr:'Clop khai th√°c zero-day trong Cleo'},
    {id:3,source:'CISA',sourceId:'cisa',category:'Advisory',categoryColor:'#00f5c4',title:'CISA b·ªï sung CVE-2025-0282 v√† CVE-2025-0283 v√†o danh s√°ch KEV kh·∫©n c·∫•p',titleEn:'CISA adds Ivanti vulnerabilities to Known Exploited Vulnerabilities catalog',summary:'CISA y√™u c·∫ßu t·∫•t c·∫£ c∆° quan li√™n bang M·ªπ v√° ngay hai l·ªó h·ªïng Ivanti ƒëang b·ªã khai th√°c t√≠ch c·ª±c. Th·ªùi h·∫°n l√† 3 tu·∫ßn k·ªÉ t·ª´ ng√†y c√¥ng b·ªë.',url:'https://www.cisa.gov',date:d,dateISO:iso,tags:['CISA','Ivanti','KEV'],urgent:true,tldr:'CISA ra l·ªánh v√° Ivanti kh·∫©n c·∫•p'},
    {id:4,source:'Krebs on Security',sourceId:'krebs',category:'Phishing',categoryColor:'#ff3a3a',title:'Chi·∫øn d·ªãch phishing gi·∫£ m·∫°o trang ƒëƒÉng nh·∫≠p Microsoft 365 nh·∫Øm v√†o doanh nghi·ªáp',titleEn:'Massive phishing campaign targets Microsoft 365 credentials',summary:'Chi·∫øn d·ªãch phishing quy m√¥ l·ªõn ƒëang s·ª≠ d·ª•ng c√°c trang gi·∫£ m·∫°o Microsoft 365 tinh vi, v∆∞·ª£t qua MFA b·∫±ng k·ªπ thu·∫≠t adversary-in-the-middle.',url:'https://krebsonsecurity.com',date:d,dateISO:iso,tags:['Phishing','Microsoft 365','AiTM'],urgent:false,tldr:'Phishing AiTM v∆∞·ª£t qua MFA Microsoft 365'},
    {id:5,source:'Dark Reading',sourceId:'dr',category:'Research',categoryColor:'#a064ff',title:'Ph√¢n t√≠ch k·ªπ thu·∫≠t backdoor FinalDraft ·∫©n trong Microsoft Graph API',titleEn:'FinalDraft malware hides C2 traffic in Microsoft Graph API',summary:'C√°c nh√† nghi√™n c·ª©u t·∫°i Elastic ƒë√£ ph√¢n t√≠ch backdoor FinalDraft s·ª≠ d·ª•ng Microsoft Graph API l√†m k√™nh C2, khi·∫øn traffic h√≤a l·∫´n v·ªõi l∆∞u l∆∞·ª£ng h·ª£p l·ªá.',url:'https://www.darkreading.com',date:d,dateISO:iso,tags:['Malware','C2','Graph API'],urgent:false,tldr:'FinalDraft d√πng Graph API ƒë·ªÉ ·∫©n C2'},
    {id:6,source:'The Hacker News',sourceId:'thn',category:'Vulnerability',categoryColor:'#4fc3f7',title:'L·ªó h·ªïng PostgreSQL cho ph√©p SQL injection qua k√Ω t·ª± multibyte kh√¥ng h·ª£p l·ªá',titleEn:'PostgreSQL vulnerability allows SQL injection through invalid multibyte characters',summary:'CVE-2025-1094 ·∫£nh h∆∞·ªüng ƒë·∫øn t·∫•t c·∫£ phi√™n b·∫£n PostgreSQL tr∆∞·ªõc 17.3, 16.7, 15.11, 14.16. C·∫≠p nh·∫≠t ngay ƒë·ªÉ tr√°nh b·ªã khai th√°c qua c√°c ·ª©ng d·ª•ng web.',url:'https://thehackernews.com',date:d,dateISO:iso,tags:['PostgreSQL','SQL Injection','CVE'],urgent:false,tldr:'PostgreSQL b·ªã SQL injection qua multibyte'},
    {id:7,source:'BleepingComputer',sourceId:'bc',category:'Malware',categoryColor:'#00f5c4',title:'Botnet Mirai phi√™n b·∫£n m·ªõi l√¢y nhi·ªÖm 50,000+ thi·∫øt b·ªã IoT trong 72 gi·ªù',titleEn:'New Mirai botnet variant infects 50,000+ IoT devices in 72 hours',summary:'Bi·∫øn th·ªÉ Mirai m·ªõi khai th√°c l·ªó h·ªïng trong router TP-Link, D-Link v√† camera IP. Botnet ƒë∆∞·ª£c d√πng ƒë·ªÉ t·∫•n c√¥ng DDoS nh·∫Øm v√†o c√°c d·ªãch v·ª• game v√† hosting.',url:'https://www.bleepingcomputer.com',date:d,dateISO:iso,tags:['Botnet','IoT','DDoS'],urgent:false,tldr:'Mirai m·ªõi l√¢y 50k+ IoT trong 3 ng√†y'},
    {id:8,source:'SC Magazine',sourceId:'sc',category:'Supply Chain',categoryColor:'#f5a623',title:'Ba th∆∞ vi·ªán npm ph·ªï bi·∫øn b·ªã nhi·ªÖm m√£ ƒë·ªôc thu th·∫≠p bi·∫øn m√¥i tr∆∞·ªùng CI/CD',titleEn:'Three popular npm packages found stealing CI/CD environment variables',summary:'C√°c g√≥i npm v·ªõi h∆°n 2 tri·ªáu l∆∞·ª£t t·∫£i/tu·∫ßn ƒë√£ b·ªã c√†i backdoor thu th·∫≠p API keys v√† tokens t·ª´ pipeline CI/CD. Ng∆∞·ªùi d√πng c·∫ßn ki·ªÉm tra v√† x√≥a ngay.',url:'https://www.scmagazine.com',date:d,dateISO:iso,tags:['Supply Chain','npm','CI/CD'],urgent:true,tldr:'3 g√≥i npm ph·ªï bi·∫øn b·ªã nhi·ªÖm backdoor'},
  ];
}


//  INIT

logActivity('info','CyberWatch VN v3.0 kh·ªüi ƒë·ªông','V·ª´a xong');
logActivity('info','K·∫øt n·ªëi NVD API + 6 ngu·ªìn RSS...','V·ª´a xong');
document.getElementById('gdate').textContent=new Date().toLocaleDateString('vi-VN');

(async()=>{
  await Promise.all([fetchCVEs(), fetchAllNews()]);
  updateGauge();
  updateTicker();
  renderSourcePills();
  startCountdown();
})();
</script>
</body>
</html>
