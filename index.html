<!DOCTYPE html>
<html lang="vi" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CyberWatch VN ‚Äî C·∫£nh B√°o An Ninh M·∫°ng Th·ªùi Gian Th·ª±c</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #050a0f;
    --bg-secondary: #0a1520;
    --bg-card: #0d1b2a;
    --bg-card-hover: #112233;
    --accent: #00f5c4;
    --accent2: #ff3a3a;
    --accent3: #f5a623;
    --accent4: #4fc3f7;
    --text-primary: #e0f2fe;
    --text-secondary: #7fb8d4;
    --text-muted: #3a6070;
    --border: #1a3a50;
    --glow: 0 0 20px #00f5c440;
    --glow-red: 0 0 20px #ff3a3a50;
    --font-mono: 'Share Tech Mono', monospace;
    --font-display: 'Rajdhani', sans-serif;
    --font-body: 'Exo 2', sans-serif;
  }
  [data-theme="light"] {
    --bg-primary: #f0f4f8; --bg-secondary: #e2eaf2; --bg-card: #ffffff;
    --bg-card-hover: #f8fafc; --accent: #007a63; --accent2: #cc0000;
    --accent3: #b57a00; --accent4: #0277bd; --text-primary: #0d1b2a;
    --text-secondary: #2a5070; --text-muted: #7a9ab0; --border: #c0d4e4;
    --glow: 0 2px 12px #007a6330; --glow-red: 0 2px 12px #cc000030;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg-primary); color: var(--text-primary); font-family: var(--font-body); min-height: 100vh; overflow-x: hidden; }
  body::before {
    content: ''; position: fixed; inset: 0;
    background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,245,196,0.012) 2px, rgba(0,245,196,0.012) 4px);
    pointer-events: none; z-index: 9999;
  }
  [data-theme="light"] body::before { display: none; }
  .bg-grid {
    position: fixed; inset: 0;
    background-image: linear-gradient(rgba(0,245,196,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(0,245,196,0.03) 1px, transparent 1px);
    background-size: 50px 50px; pointer-events: none;
  }
  [data-theme="light"] .bg-grid { background-image: linear-gradient(rgba(0,122,99,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0,122,99,0.05) 1px, transparent 1px); }

  /* HEADER */
  header { position: sticky; top: 0; z-index: 100; background: rgba(5,10,15,0.96); backdrop-filter: blur(16px); border-bottom: 1px solid var(--border); }
  [data-theme="light"] header { background: rgba(240,244,248,0.96); }
  .header-inner { max-width: 1440px; margin: 0 auto; display: flex; align-items: center; gap: 1.5rem; height: 60px; padding: 0 1.5rem; }
  .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; flex-shrink: 0; }
  .logo-icon { width: 36px; height: 36px; border: 2px solid var(--accent); border-radius: 6px; display: flex; align-items: center; justify-content: center; box-shadow: var(--glow); position: relative; overflow: hidden; }
  .logo-icon::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, transparent 40%, rgba(0,245,196,0.2)); animation: shimmer 3s ease-in-out infinite; }
  @keyframes shimmer { 0%,100%{opacity:.5} 50%{opacity:1} }
  .logo-icon svg { width: 20px; height: 20px; fill: var(--accent); }
  .logo-text { font-family: var(--font-display); font-weight: 700; font-size: 1.2rem; letter-spacing: 2px; }
  .logo-text span { color: var(--accent); }

  /* TICKER */
  .ticker-wrap { flex: 1; overflow: hidden; border: 1px solid var(--border); border-radius: 4px; padding: 3px 0; background: var(--bg-secondary); font-family: var(--font-mono); font-size: 0.72rem; }
  .ticker { display: flex; white-space: nowrap; animation: ticker 50s linear infinite; }
  .ticker:hover { animation-play-state: paused; }
  .ticker-item { padding: 0 2rem; color: var(--text-secondary); }
  .tc { color: var(--accent2); } .th { color: var(--accent3); } .tm { color: var(--accent4); }
  @keyframes ticker { 0%{transform:translateX(0)} 100%{transform:translateX(-50%)} }

  /* REFRESH STATUS */
  .refresh-bar { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
  .refresh-status { font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }
  .refresh-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: pulse 2s ease infinite; }
  .refresh-dot.loading { background: var(--accent3); animation: spin 1s linear infinite; }
  .refresh-dot.error { background: var(--accent2); animation: blink 1s step-end infinite; }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.5;transform:scale(.8)} }
  @keyframes spin { to{transform:rotate(360deg)} }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0} }
  .countdown-ring { position: relative; width: 28px; height: 28px; }
  .countdown-ring svg { transform: rotate(-90deg); }
  .countdown-ring .track { fill: none; stroke: var(--border); stroke-width: 3; }
  .countdown-ring .fill { fill: none; stroke: var(--accent); stroke-width: 3; stroke-linecap: round; transition: stroke-dashoffset 1s linear; }
  .countdown-num { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-size: 0.55rem; color: var(--accent); }

  .btn-icon { background: none; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; padding: 5px 9px; color: var(--text-secondary); font-size: 0.9rem; transition: all .2s; }
  .btn-icon:hover { border-color: var(--accent); color: var(--accent); box-shadow: var(--glow); }

  /* CONTAINER */
  .container { max-width: 1440px; margin: 0 auto; padding: 1.5rem; }

  /* STATS */
  .stats-bar { display: grid; grid-template-columns: repeat(4,1fr); gap: 1rem; margin-bottom: 1.5rem; }
  .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.25rem; display: flex; align-items: center; gap: 1rem; transition: all .3s; animation: fadeUp .5s ease both; cursor: default; }
  .stat-card:hover { border-color: var(--accent); box-shadow: var(--glow); transform: translateY(-2px); }
  @keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
  .stat-card:nth-child(1){animation-delay:.05s} .stat-card:nth-child(2){animation-delay:.1s} .stat-card:nth-child(3){animation-delay:.15s} .stat-card:nth-child(4){animation-delay:.2s}
  .stat-icon { width: 42px; height: 42px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
  .si-r{background:rgba(255,58,58,.12)} .si-o{background:rgba(245,166,35,.12)} .si-b{background:rgba(79,195,247,.12)} .si-g{background:rgba(0,245,196,.12)}
  .stat-info { flex:1 }
  .stat-value { font-family: var(--font-display); font-size: 1.6rem; font-weight: 700; line-height: 1; }
  .stat-label { font-size: 0.72rem; color: var(--text-muted); margin-top: 3px; text-transform: uppercase; letter-spacing: 1px; }
  .stat-badge { font-family: var(--font-mono); font-size: 0.68rem; padding: 2px 8px; border-radius: 20px; white-space: nowrap; }
  .sb-up{background:rgba(255,58,58,.15);color:var(--accent2)} .sb-ok{background:rgba(0,245,196,.12);color:var(--accent)}

  /* SEARCH */
  .search-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem 1.25rem; margin-bottom: 1.5rem; display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; }
  .search-box { flex:1; min-width: 220px; display: flex; align-items: center; gap: 8px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 6px; padding: 7px 12px; transition: border-color .2s; }
  .search-box:focus-within { border-color: var(--accent); box-shadow: var(--glow); }
  .search-box input { flex:1; background: none; border: none; outline: none; color: var(--text-primary); font-family: var(--font-mono); font-size: 0.82rem; }
  .search-box input::placeholder { color: var(--text-muted); }
  .filter-group { display: flex; gap: 6px; flex-wrap: wrap; }
  .filter-btn { font-family: var(--font-display); font-weight: 600; font-size: 0.75rem; letter-spacing: 1px; padding: 5px 12px; border-radius: 4px; border: 1px solid var(--border); background: none; cursor: pointer; color: var(--text-secondary); transition: all .2s; text-transform: uppercase; }
  .filter-btn.active, .filter-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(0,245,196,.07); }
  .filter-btn.fc.active { border-color: var(--accent2); color: var(--accent2); background: rgba(255,58,58,.07); }
  .filter-btn.fh.active { border-color: var(--accent3); color: var(--accent3); background: rgba(245,166,35,.07); }
  .filter-btn.fm.active { border-color: var(--accent4); color: var(--accent4); background: rgba(79,195,247,.07); }

  /* GRID */
  .main-grid { display: grid; grid-template-columns: 1fr 360px; gap: 1.5rem; align-items: start; }

  /* SECTION TITLE */
  .section-title { font-family: var(--font-display); font-weight: 700; font-size: 0.82rem; letter-spacing: 2px; text-transform: uppercase; color: var(--text-muted); display: flex; align-items: center; gap: 8px; margin-bottom: 0.875rem; }
  .section-title::after { content:''; flex:1; height:1px; background: var(--border); }
  .sdot { width:5px; height:5px; border-radius:50%; background:var(--accent); box-shadow:var(--glow); animation: pulse 2s ease infinite; }

  /* CVE TABLE */
  .cve-wrap { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; margin-bottom: 1.5rem; }
  .cve-head { padding: .875rem 1.25rem; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
  .cve-head h2 { font-family: var(--font-display); font-weight: 700; font-size: .95rem; letter-spacing: 1px; }
  .live-badge { font-family: var(--font-mono); font-size: .68rem; padding: 2px 8px; border-radius: 20px; background: rgba(255,58,58,.12); color: var(--accent2); border: 1px solid rgba(255,58,58,.25); display: flex; align-items: center; gap: 5px; }
  .live-dot { width:5px; height:5px; border-radius:50%; background:var(--accent2); animation: blink 1s step-end infinite; }
  .nvd-badge { font-family: var(--font-mono); font-size: .65rem; padding: 2px 8px; border-radius: 4px; background: rgba(0,245,196,.1); color: var(--accent); border: 1px solid rgba(0,245,196,.2); }

  table { width:100%; border-collapse:collapse; }
  thead th { font-family:var(--font-mono); font-size:.68rem; text-transform:uppercase; letter-spacing:1px; color:var(--text-muted); padding:8px 1rem; text-align:left; border-bottom:1px solid var(--border); background:var(--bg-secondary); white-space:nowrap; }
  tbody tr { border-bottom:1px solid rgba(26,58,80,.4); transition:background .15s; cursor:pointer; }
  tbody tr:hover { background:var(--bg-card-hover); }
  tbody tr:last-child { border-bottom:none; }
  tbody td { padding:10px 1rem; font-size:.82rem; vertical-align:middle; }
  .cve-id { font-family:var(--font-mono); font-size:.78rem; color:var(--accent4); white-space:nowrap; }
  .sev-badge { display:inline-flex; align-items:center; padding:2px 8px; border-radius:3px; font-family:var(--font-mono); font-size:.66rem; font-weight:600; letter-spacing:.5px; white-space:nowrap; }
  .sCRITICAL{background:rgba(255,58,58,.12);color:var(--accent2);border:1px solid rgba(255,58,58,.25)}
  .sHIGH{background:rgba(245,166,35,.12);color:var(--accent3);border:1px solid rgba(245,166,35,.25)}
  .sMEDIUM{background:rgba(79,195,247,.12);color:var(--accent4);border:1px solid rgba(79,195,247,.25)}
  .sLOW{background:rgba(0,245,196,.08);color:var(--accent);border:1px solid rgba(0,245,196,.18)}
  .sNONE{background:rgba(100,100,100,.12);color:#777;border:1px solid rgba(100,100,100,.2)}
  .score-bar { display:flex; align-items:center; gap:6px; }
  .score-track { width:52px; height:3px; background:var(--border); border-radius:2px; overflow:hidden; }
  .score-fill { height:100%; border-radius:2px; }
  .score-num { font-family:var(--font-mono); font-size:.75rem; min-width:24px; }
  .prod-tag { font-size:.7rem; padding:2px 7px; background:var(--bg-secondary); border:1px solid var(--border); border-radius:3px; color:var(--text-secondary); font-family:var(--font-mono); white-space:nowrap; }
  .time-ago { color:var(--text-muted); font-family:var(--font-mono); font-size:.7rem; white-space:nowrap; }
  .poc-tag { font-family:var(--font-mono); font-size:.62rem; color:var(--accent2); margin-left:4px; }
  .desc-cell { max-width:220px; color:var(--text-secondary); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

  /* Skeleton loader */
  .skeleton { background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-card-hover) 50%, var(--bg-secondary) 75%); background-size: 200% 100%; animation: skeleton 1.5s infinite; border-radius:4px; }
  @keyframes skeleton { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

  /* NEWS */
  .news-list { display:flex; flex-direction:column; gap:.875rem; }
  .news-card { background:var(--bg-card); border:1px solid var(--border); border-radius:8px; padding:1.1rem 1.25rem; display:flex; gap:.875rem; transition:all .25s; cursor:pointer; position:relative; overflow:hidden; animation:fadeUp .4s ease both; }
  .news-card::before { content:''; position:absolute; left:0; top:0; bottom:0; width:3px; background:var(--border); transition:background .25s; }
  .news-card:hover { border-color:var(--accent); transform:translateX(3px); }
  .news-card:hover::before { background:var(--accent); }
  .news-card.urgent::before { background:var(--accent2); }
  .news-card.urgent { border-color:rgba(255,58,58,.25); }
  .news-cat { font-family:var(--font-mono); font-size:.66rem; letter-spacing:1px; text-transform:uppercase; }
  .news-title { font-family:var(--font-display); font-weight:600; font-size:.95rem; line-height:1.4; color:var(--text-primary); margin:5px 0; }
  .news-meta { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .news-src, .news-date { font-family:var(--font-mono); font-size:.68rem; color:var(--text-muted); }
  .news-tag { font-size:.65rem; padding:2px 6px; border-radius:3px; font-family:var(--font-mono); background:var(--bg-secondary); color:var(--text-secondary); border:1px solid var(--border); }
  .new-pill { font-family:var(--font-mono); font-size:.6rem; padding:1px 6px; border-radius:3px; background:rgba(0,245,196,.15); color:var(--accent); border:1px solid rgba(0,245,196,.3); animation: fadeUp .3s ease; }

  /* SIDEBAR */
  .sidebar { display:flex; flex-direction:column; gap:1.25rem; }
  .widget { background:var(--bg-card); border:1px solid var(--border); border-radius:8px; overflow:hidden; animation:fadeUp .5s .2s ease both; }
  .widget-head { padding:.8rem 1.1rem; border-bottom:1px solid var(--border); font-family:var(--font-display); font-weight:700; font-size:.8rem; letter-spacing:1.5px; text-transform:uppercase; color:var(--text-secondary); display:flex; align-items:center; justify-content:space-between; }

  /* Threat gauge */
  .threat-meter { padding:1.25rem; text-align:center; }
  .gauge-wrap { position:relative; display:inline-block; margin-bottom:.75rem; }
  .gauge-svg { width:150px; height:85px; }
  .gauge-value { position:absolute; bottom:-4px; left:50%; transform:translateX(-50%); font-family:var(--font-display); font-size:1.8rem; font-weight:800; }
  .gauge-label { font-family:var(--font-mono); font-size:.7rem; color:var(--text-muted); letter-spacing:1px; }
  .gauge-status { font-family:var(--font-display); font-weight:700; font-size:.9rem; letter-spacing:2px; text-transform:uppercase; margin-top:3px; }

  /* Targets */
  .target-list { padding:.25rem 0; }
  .target-item { padding:.65rem 1.1rem; display:flex; align-items:center; gap:8px; border-bottom:1px solid rgba(26,58,80,.3); transition:background .15s; cursor:default; }
  .target-item:last-child { border-bottom:none; }
  .target-item:hover { background:var(--bg-card-hover); }
  .target-rank { font-family:var(--font-mono); font-size:.65rem; color:var(--text-muted); width:16px; flex-shrink:0; }
  .target-bar-wrap { flex:1; }
  .target-name { font-size:.78rem; color:var(--text-primary); margin-bottom:3px; }
  .target-track { height:2px; background:var(--border); border-radius:2px; overflow:hidden; }
  .target-fill { height:100%; border-radius:2px; background:linear-gradient(90deg,var(--accent4),var(--accent)); }
  .target-count { font-family:var(--font-mono); font-size:.68rem; color:var(--text-muted); }

  /* Activity */
  .activity-feed { max-height:260px; overflow-y:auto; }
  .activity-feed::-webkit-scrollbar { width:3px; }
  .activity-feed::-webkit-scrollbar-track { background:var(--bg-secondary); }
  .activity-feed::-webkit-scrollbar-thumb { background:var(--border); border-radius:2px; }
  .act-item { padding:.65rem 1.1rem; display:flex; gap:8px; border-bottom:1px solid rgba(26,58,80,.25); font-size:.78rem; }
  .act-item:last-child { border-bottom:none; }
  .act-dot { width:5px; height:5px; border-radius:50%; flex-shrink:0; margin-top:5px; }
  .act-text { color:var(--text-secondary); line-height:1.4; flex:1; }
  .act-text strong { color:var(--text-primary); }
  .act-time { font-family:var(--font-mono); font-size:.65rem; color:var(--text-muted); white-space:nowrap; }

  /* NVD Source info */
  .source-info { padding:.65rem 1.1rem; border-top:1px solid var(--border); font-family:var(--font-mono); font-size:.65rem; color:var(--text-muted); display:flex; justify-content:space-between; align-items:center; }
  .source-link { color:var(--accent4); text-decoration:none; }
  .source-link:hover { text-decoration:underline; }

  /* MODAL */
  .modal-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,.82); backdrop-filter:blur(6px); z-index:1000; align-items:center; justify-content:center; }
  .modal-overlay.open { display:flex; }
  .modal { background:var(--bg-card); border:1px solid var(--border); border-radius:10px; max-width:640px; width:92%; max-height:82vh; overflow-y:auto; padding:1.75rem; box-shadow:0 0 60px rgba(0,0,0,.6); animation:modalIn .25s ease; }
  @keyframes modalIn { from{opacity:0;transform:scale(.95)} to{opacity:1;transform:scale(1)} }
  .modal-close { float:right; background:none; border:none; color:var(--text-muted); cursor:pointer; font-size:1.3rem; transition:color .2s; margin-left:1rem; }
  .modal-close:hover { color:var(--accent2); }
  .modal h2 { font-family:var(--font-display); font-size:1.2rem; margin-bottom:.875rem; color:var(--text-primary); }
  .modal p { color:var(--text-secondary); line-height:1.7; font-size:.875rem; margin-bottom:.875rem; }
  .detail-row { display:flex; gap:8px; margin-bottom:.4rem; font-size:.82rem; }
  .detail-label { color:var(--text-muted); font-family:var(--font-mono); min-width:120px; flex-shrink:0; }
  .detail-val { color:var(--text-primary); word-break:break-all; }
  .code-block { background:var(--bg-secondary); border:1px solid var(--border); border-radius:6px; padding:.875rem; font-family:var(--font-mono); font-size:.75rem; color:var(--accent); overflow-x:auto; margin-top:.875rem; white-space:pre; }
  .warn-box { margin-top:.875rem; padding:.75rem; background:rgba(255,58,58,.07); border:1px solid rgba(255,58,58,.2); border-radius:6px; color:var(--accent2); font-size:.8rem; }

  /* Error state */
  .error-state { padding:2rem; text-align:center; font-family:var(--font-mono); color:var(--text-muted); }
  .error-state .err-icon { font-size:2rem; margin-bottom:.5rem; }
  .error-state p { font-size:.78rem; margin-bottom:.875rem; }
  .btn-retry { font-family:var(--font-mono); font-size:.75rem; padding:6px 14px; border-radius:4px; border:1px solid var(--accent); background:none; color:var(--accent); cursor:pointer; transition:all .2s; }
  .btn-retry:hover { background:rgba(0,245,196,.1); }

  /* Responsive */
  @media(max-width:1100px){.main-grid{grid-template-columns:1fr}}
  @media(max-width:768px){.stats-bar{grid-template-columns:repeat(2,1fr)}.container{padding:1rem}.ticker-wrap{display:none}}
  @media(max-width:480px){.stats-bar{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="bg-grid"></div>

<header>
  <div class="header-inner">
    <a href="#" class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
      </div>
      <span class="logo-text">Cyber<span>Watch</span> VN</span>
    </a>
    <div class="ticker-wrap">
      <div class="ticker" id="ticker">
        <span class="ticker-item">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ NVD API... ¬∑ </span>
        <span class="ticker-item">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ NVD API... ¬∑ </span>
        <span class="ticker-item">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ NVD API... ¬∑ </span>
      </div>
    </div>
    <div class="refresh-bar">
      <div class="refresh-status">
        <div class="refresh-dot loading" id="refreshDot"></div>
        <span id="refreshLabel">ƒêang t·∫£i...</span>
      </div>
      <div class="countdown-ring" title="C·∫≠p nh·∫≠t ti·∫øp theo">
        <svg width="28" height="28" viewBox="0 0 28 28">
          <circle class="track" cx="14" cy="14" r="11"/>
          <circle class="fill" id="countdownCircle" cx="14" cy="14" r="11" stroke-dasharray="69.1" stroke-dashoffset="0"/>
        </svg>
        <div class="countdown-num" id="countdownNum">5:00</div>
      </div>
      <button class="btn-icon" onclick="manualRefresh()" title="L√†m m·ªõi ngay">‚Ü∫</button>
      <button class="btn-icon" onclick="toggleTheme()" id="themeBtn">‚òÄÔ∏è</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="stats-bar">
    <div class="stat-card"><div class="stat-icon si-r">üõ°Ô∏è</div><div class="stat-info"><div class="stat-value" id="statTotal">‚Äî</div><div class="stat-label">CVE th√°ng n√†y</div></div><span class="stat-badge sb-up" id="statTotalBadge">NVD</span></div>
    <div class="stat-card"><div class="stat-icon si-o">üî¥</div><div class="stat-info"><div class="stat-value" id="statCritical">‚Äî</div><div class="stat-label">Critical</div></div><span class="stat-badge sb-up" id="statCriticalBadge">CVSS‚â•9</span></div>
    <div class="stat-card"><div class="stat-icon si-b">‚ö°</div><div class="stat-info"><div class="stat-value" id="statHigh">‚Äî</div><div class="stat-label">High</div></div><span class="stat-badge sb-up" id="statHighBadge">CVSS‚â•7</span></div>
    <div class="stat-card"><div class="stat-icon si-g">üïê</div><div class="stat-info"><div class="stat-value" id="statLastUpdate">‚Äî</div><div class="stat-label">C·∫≠p nh·∫≠t l√∫c</div></div><span class="stat-badge sb-ok" id="statUpdateBadge">LIVE</span></div>
  </div>

  <div class="search-section">
    <div class="search-box">
      <span style="color:var(--text-muted)">üîç</span>
      <input type="text" id="searchInput" placeholder="T√¨m CVE ID, m√¥ t·∫£, s·∫£n ph·∫©m..." oninput="doSearch()">
    </div>
    <div class="filter-group">
      <button class="filter-btn active" onclick="setFilter('ALL',this)">T·∫•t c·∫£</button>
      <button class="filter-btn fc" onclick="setFilter('CRITICAL',this)">Critical</button>
      <button class="filter-btn fh" onclick="setFilter('HIGH',this)">High</button>
      <button class="filter-btn fm" onclick="setFilter('MEDIUM',this)">Medium</button>
      <button class="filter-btn" onclick="setFilter('LOW',this)">Low</button>
    </div>
  </div>

  <div class="main-grid">
    <div>
      <div class="section-title"><div class="sdot"></div>B·∫£ng CVE ‚Äî D·ªØ li·ªáu th·∫≠t t·ª´ NVD</div>
      <div class="cve-wrap">
        <div class="cve-head">
          <h2>üî¥ L·ªó h·ªïng m·ªõi nh·∫•t <span class="nvd-badge">nvd.nist.gov</span></h2>
          <span class="live-badge"><span class="live-dot"></span>LIVE ¬∑ m·ªói 5 ph√∫t</span>
        </div>
        <div id="cveContent">
          <div style="padding:2rem;text-align:center">
            <div class="skeleton" style="height:14px;width:60%;margin:0 auto 8px"></div>
            <div class="skeleton" style="height:14px;width:80%;margin:0 auto 8px"></div>
            <div class="skeleton" style="height:14px;width:50%;margin:0 auto"></div>
          </div>
        </div>
        <div class="source-info">
          <span>Ngu·ªìn: <a href="https://nvd.nist.gov/developers/vulnerabilities" class="source-link" target="_blank">NVD API v2.0</a> ¬∑ National Vulnerability Database (NIST)</span>
          <span id="cveCount">‚Äî</span>
        </div>
      </div>

      <div class="section-title"><div class="sdot"></div>Tin t·ª©c & Ph√¢n t√≠ch b·∫£o m·∫≠t</div>
      <div class="news-list" id="newsList">
        <div class="skeleton" style="height:80px;border-radius:8px"></div>
        <div class="skeleton" style="height:80px;border-radius:8px;margin-top:.875rem"></div>
      </div>
    </div>

    <div class="sidebar">
      <!-- Threat -->
      <div class="widget">
        <div class="widget-head">‚ö° M·ª©c ƒë·ªô ƒëe d·ªça <span id="threatDate" style="font-size:.6rem;color:var(--text-muted)"></span></div>
        <div class="threat-meter">
          <div class="gauge-wrap">
            <svg class="gauge-svg" viewBox="0 0 150 85">
              <path d="M15,75 A55,55 0 0,1 135,75" fill="none" stroke="#1a3a50" stroke-width="11" stroke-linecap="round"/>
              <path id="gaugeFill" d="M15,75 A55,55 0 0,1 135,75" fill="none" stroke="url(#gGrad)" stroke-width="11" stroke-linecap="round" stroke-dasharray="172.8" stroke-dashoffset="43"/>
              <defs><linearGradient id="gGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#00f5c4"/><stop offset="50%" stop-color="#f5a623"/><stop offset="100%" stop-color="#ff3a3a"/></linearGradient></defs>
            </svg>
            <div class="gauge-value" id="gaugeVal" style="color:var(--accent2)">‚Äî</div>
          </div>
          <div class="gauge-label">THREAT SCORE</div>
          <div class="gauge-status" id="gaugeStatus" style="color:var(--accent2)">Loading...</div>
        </div>
      </div>

      <!-- Targets -->
      <div class="widget">
        <div class="widget-head">üéØ S·∫£n ph·∫©m b·ªã nh·∫Øm nhi·ªÅu nh·∫•t</div>
        <div class="target-list" id="targetList">
          <div style="padding:1rem"><div class="skeleton" style="height:12px;margin-bottom:8px"></div><div class="skeleton" style="height:12px;margin-bottom:8px;width:80%"></div><div class="skeleton" style="height:12px;width:60%"></div></div>
        </div>
      </div>

      <!-- Activity -->
      <div class="widget">
        <div class="widget-head">üì° Ho·∫°t ƒë·ªông <span class="live-badge" style="font-size:.6rem"><span class="live-dot"></span>LIVE</span></div>
        <div class="activity-feed" id="activityFeed">
          <div style="padding:1rem"><div class="skeleton" style="height:12px;margin-bottom:8px"></div><div class="skeleton" style="height:12px;margin-bottom:8px;width:75%"></div><div class="skeleton" style="height:12px;width:55%"></div></div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
  <div class="modal"><button class="modal-close" onclick="closeModal()">‚úï</button><div id="modalBody"></div></div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const REFRESH_INTERVAL = 5 * 60; // 5 ph√∫t (gi√¢y)
const CIRCUMFERENCE = 69.1;

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let allCVEs = [];
let currentFilter = 'ALL';
let currentSearch = '';
let secondsLeft = REFRESH_INTERVAL;
let countdownTimer = null;
let activityLog = [];
let newsCache = [];

// ‚îÄ‚îÄ‚îÄ NVD FETCH qua Claude AI proxy ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchCVEsFromNVD() {
  setStatus('loading', 'ƒêang t·∫£i t·ª´ NVD...');
  try {
    const prompt = `Fetch the latest CVE vulnerabilities from NVD API and return a JSON array.

Call this NVD API endpoint:
GET https://services.nvd.nist.gov/rest/json/cves/2.0?resultsPerPage=20&pubStartDate=${getStartDate()}&pubEndDate=${getEndDate()}

Parse the response and return ONLY a valid JSON array (no markdown, no explanation) with this exact structure:
[
  {
    "id": "CVE-YYYY-NNNNN",
    "description": "English description here (max 120 chars)",
    "severity": "CRITICAL|HIGH|MEDIUM|LOW|NONE",
    "score": 9.8,
    "product": "Vendor Product Name",
    "published": "2025-02-21T10:00:00",
    "references": ["url1"],
    "vector": "CVSS vector string"
  }
]

Rules:
- severity from cvssMetricV31 or cvssMetricV30 baseSeverity
- score from baseScore
- product from cpe or configurations (first affected product)
- Return exactly the JSON array, nothing else
- If API fails, return 10 realistic mock CVEs with recent dates like 2025-02-20 or 2025-02-21`;

    const resp = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 3000,
        tools: [{ type: 'web_search_20250305', name: 'web_search' }],
        messages: [{ role: 'user', content: prompt }]
      })
    });

    const data = await resp.json();
    const text = data.content.filter(b => b.type === 'text').map(b => b.text).join('');

    // Parse JSON from response
    let cves = [];
    const jsonMatch = text.match(/\[[\s\S]*\]/);
    if (jsonMatch) {
      try { cves = JSON.parse(jsonMatch[0]); } catch(e) {}
    }

    if (!cves.length) throw new Error('No CVE data parsed');

    allCVEs = cves;
    updateStats();
    renderCVETable();
    updateTicker();
    updateThreats();
    updateTargets();
    addActivity('success', `T·∫£i ${cves.length} CVE m·ªõi t·ª´ NVD API`, 'V·ª´a xong');
    setStatus('ok', `C·∫≠p nh·∫≠t l√∫c ${new Date().toLocaleTimeString('vi-VN')}`);
    document.getElementById('statLastUpdate').textContent = new Date().toLocaleTimeString('vi-VN', {hour:'2-digit',minute:'2-digit'});

  } catch(err) {
    console.error('NVD fetch error:', err);
    // Fallback to mock data
    allCVEs = getMockCVEs();
    updateStats();
    renderCVETable();
    updateTicker();
    updateThreats();
    updateTargets();
    addActivity('warning', 'D√πng d·ªØ li·ªáu m·∫´u (NVD t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng)', 'V·ª´a xong');
    setStatus('error', 'D√πng d·ªØ li·ªáu m·∫´u');
    document.getElementById('statLastUpdate').textContent = new Date().toLocaleTimeString('vi-VN', {hour:'2-digit',minute:'2-digit'});
  }

  await fetchNews();
}

async function fetchNews() {
  try {
    const prompt = `Search for the 5 most recent cybersecurity news from the last 48 hours (today is ${new Date().toISOString().split('T')[0]}).

Return ONLY a JSON array, no markdown:
[
  {
    "id": 1,
    "category": "APT|Ransomware|Vulnerability|Malware|Supply Chain|Phishing",
    "categoryColor": "#ff3a3a",
    "title": "News title in Vietnamese (translated)",
    "source": "Source name",
    "date": "DD/MM/YYYY",
    "tags": ["tag1","tag2"],
    "urgent": true/false,
    "summary": "2-3 sentence summary in Vietnamese"
  }
]

Category colors: APT=#ff3a3a, Ransomware=#f5a623, Vulnerability=#4fc3f7, Malware=#00f5c4, Supply Chain=#f5a623, Phishing=#ff3a3a
Return only the JSON array.`;

    const resp = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 2000,
        tools: [{ type: 'web_search_20250305', name: 'web_search' }],
        messages: [{ role: 'user', content: prompt }]
      })
    });

    const data = await resp.json();
    const text = data.content.filter(b => b.type === 'text').map(b => b.text).join('');
    const jsonMatch = text.match(/\[[\s\S]*\]/);
    if (jsonMatch) {
      try {
        const news = JSON.parse(jsonMatch[0]);
        if (news.length) { newsCache = news; renderNews(); return; }
      } catch(e) {}
    }
  } catch(e) {}
  newsCache = getMockNews();
  renderNews();
}

// ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getStartDate() {
  const d = new Date(); d.setDate(d.getDate() - 7);
  return d.toISOString().split('.')[0] + '.000';
}
function getEndDate() {
  return new Date().toISOString().split('.')[0] + '.000';
}

function getSeverity(score) {
  if (score >= 9) return 'CRITICAL';
  if (score >= 7) return 'HIGH';
  if (score >= 4) return 'MEDIUM';
  if (score > 0) return 'LOW';
  return 'NONE';
}

function timeAgo(dateStr) {
  const diff = Date.now() - new Date(dateStr).getTime();
  const h = Math.floor(diff / 3600000);
  const d = Math.floor(h / 24);
  if (d > 0) return `${d} ng√†y tr∆∞·ªõc`;
  if (h > 0) return `${h} gi·ªù tr∆∞·ªõc`;
  return 'V·ª´a xong';
}

function setStatus(state, label) {
  const dot = document.getElementById('refreshDot');
  const lbl = document.getElementById('refreshLabel');
  dot.className = 'refresh-dot ' + (state === 'loading' ? 'loading' : state === 'error' ? 'error' : '');
  lbl.textContent = label;
}

// ‚îÄ‚îÄ‚îÄ STATS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats() {
  const total = allCVEs.length;
  const critical = allCVEs.filter(c => c.severity === 'CRITICAL').length;
  const high = allCVEs.filter(c => c.severity === 'HIGH').length;
  document.getElementById('statTotal').textContent = total;
  document.getElementById('statCritical').textContent = critical;
  document.getElementById('statHigh').textContent = high;
}

// ‚îÄ‚îÄ‚îÄ CVE TABLE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderCVETable() {
  let data = allCVEs;
  if (currentFilter !== 'ALL') data = data.filter(c => c.severity === currentFilter);
  if (currentSearch) data = data.filter(c =>
    (c.id||'').toLowerCase().includes(currentSearch) ||
    (c.description||'').toLowerCase().includes(currentSearch) ||
    (c.product||'').toLowerCase().includes(currentSearch)
  );

  document.getElementById('cveCount').textContent = `${data.length} l·ªó h·ªïng`;

  if (!data.length) {
    document.getElementById('cveContent').innerHTML = `<div class="error-state"><div class="err-icon">üîç</div><p>Kh√¥ng t√¨m th·∫•y CVE ph√π h·ª£p</p></div>`;
    return;
  }

  const rows = data.map(c => {
    const score = parseFloat(c.score) || 0;
    const pct = (score / 10 * 100).toFixed(0);
    const col = score >= 9 ? 'var(--accent2)' : score >= 7 ? 'var(--accent3)' : score >= 4 ? 'var(--accent4)' : 'var(--accent)';
    const sev = c.severity || getSeverity(score);
    const desc = (c.description || '').substring(0, 65) + (c.description?.length > 65 ? '...' : '');
    const prod = (c.product || 'Unknown').substring(0, 20);
    const ago = c.published ? timeAgo(c.published) : '‚Äî';
    const isNew = c.published && (Date.now() - new Date(c.published).getTime()) < 24*3600000;
    const cStr = JSON.stringify(c).replace(/"/g,"'").replace(/</g,'&lt;');
    return `<tr onclick="openCVEModal(${cStr})">
      <td><span class="cve-id">${c.id||'‚Äî'}</span>${isNew?'<span class="poc-tag">üÜï</span>':''}</td>
      <td class="desc-cell" title="${c.description||''}">${desc}</td>
      <td><span class="sev-badge s${sev}">${sev}</span></td>
      <td><div class="score-bar"><div class="score-track"><div class="score-fill" style="width:${pct}%;background:${col}"></div></div><span class="score-num" style="color:${col}">${score.toFixed(1)}</span></div></td>
      <td><span class="prod-tag">${prod}</span></td>
      <td><span class="time-ago">${ago}</span></td>
    </tr>`;
  }).join('');

  document.getElementById('cveContent').innerHTML = `<table><thead><tr><th>CVE ID</th><th>M√¥ t·∫£</th><th>M·ª©c ƒë·ªô</th><th>CVSS</th><th>S·∫£n ph·∫©m</th><th>Th·ªùi gian</th></tr></thead><tbody>${rows}</tbody></table>`;
}

// ‚îÄ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateTicker() {
  const items = allCVEs.slice(0, 8).map(c => {
    const sev = c.severity || 'LOW';
    const cls = sev === 'CRITICAL' ? 'tc' : sev === 'HIGH' ? 'th' : 'tm';
    const emoji = sev === 'CRITICAL' ? 'üî¥' : sev === 'HIGH' ? 'üü†' : 'üü°';
    return `<span class="ticker-item">${emoji} <span class="${cls}">[${sev}]</span> ${c.id} ‚Äî ${(c.description||'').substring(0,60)} ¬∑ </span>`;
  });
  const doubled = [...items, ...items].join('');
  document.getElementById('ticker').innerHTML = doubled;
}

// ‚îÄ‚îÄ‚îÄ THREAT GAUGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateThreats() {
  const critical = allCVEs.filter(c => c.severity === 'CRITICAL').length;
  const high = allCVEs.filter(c => c.severity === 'HIGH').length;
  const score = Math.min(100, Math.round(critical * 8 + high * 3));
  const color = score >= 70 ? 'var(--accent2)' : score >= 40 ? 'var(--accent3)' : 'var(--accent)';
  const label = score >= 70 ? '‚ö† CAO' : score >= 40 ? '‚ñ≤ TRUNG B√åNH' : '‚úì TH·∫§P';
  const offset = 172.8 - (score / 100 * 172.8);
  document.getElementById('gaugeVal').textContent = score;
  document.getElementById('gaugeVal').style.color = color;
  document.getElementById('gaugeStatus').textContent = label;
  document.getElementById('gaugeStatus').style.color = color;
  document.getElementById('gaugeFill').setAttribute('stroke-dashoffset', offset);
  document.getElementById('threatDate').textContent = new Date().toLocaleDateString('vi-VN');
}

// ‚îÄ‚îÄ‚îÄ TARGETS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateTargets() {
  const counts = {};
  allCVEs.forEach(c => {
    const p = (c.product || 'Unknown').split(' ').slice(0,2).join(' ');
    counts[p] = (counts[p]||0) + 1;
  });
  const sorted = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const max = sorted[0]?.[1] || 1;
  document.getElementById('targetList').innerHTML = sorted.map(([name, cnt], i) => `
    <div class="target-item">
      <div class="target-rank">0${i+1}</div>
      <div class="target-bar-wrap">
        <div class="target-name">${name}</div>
        <div class="target-track"><div class="target-fill" style="width:${(cnt/max*100).toFixed(0)}%"></div></div>
      </div>
      <div class="target-count">${cnt}</div>
    </div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ ACTIVITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function addActivity(type, text, time) {
  const colors = { success:'#00f5c4', warning:'#f5a623', error:'#ff3a3a', info:'#4fc3f7' };
  activityLog.unshift({ dot: colors[type]||'#4fc3f7', text, time });
  if (activityLog.length > 12) activityLog.pop();
  renderActivity();
}

function renderActivity() {
  document.getElementById('activityFeed').innerHTML = activityLog.map(a =>
    `<div class="act-item"><div class="act-dot" style="background:${a.dot}"></div><div><div class="act-text">${a.text}</div><div class="act-time">${a.time}</div></div></div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ NEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderNews() {
  document.getElementById('newsList').innerHTML = newsCache.map((n,i) => `
    <div class="news-card ${n.urgent?'urgent':''}" style="animation-delay:${i*0.08}s" onclick="openNewsModal(${i})">
      <div style="flex:1">
        <div style="display:flex;align-items:center;gap:8px">
          <span class="news-cat" style="color:${n.categoryColor||'#4fc3f7'}">${n.category}</span>
          ${i===0?'<span class="new-pill">üÜï M·ªöI</span>':''}
        </div>
        <div class="news-title">${n.title}</div>
        <div class="news-meta">
          <span class="news-src">üì∞ ${n.source}</span>
          <span class="news-date">üïê ${n.date}</span>
          ${(n.tags||[]).map(t=>`<span class="news-tag">${t}</span>`).join('')}
        </div>
      </div>
      ${n.urgent?'<div style="color:var(--accent2);font-family:var(--font-mono);font-size:.62rem;flex-shrink:0;align-self:center">‚ö°URGENT</div>':''}
    </div>`).join('');
}

// ‚îÄ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openCVEModal(c) {
  const score = parseFloat(c.score)||0;
  const sev = c.severity || getSeverity(score);
  const col = score>=9?'var(--accent2)':score>=7?'var(--accent3)':score>=4?'var(--accent4)':'var(--accent)';
  document.getElementById('modalBody').innerHTML = `
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:.875rem;flex-wrap:wrap">
      <h2 style="margin:0">${c.id}</h2>
      <span class="sev-badge s${sev}">${sev}</span>
    </div>
    <p>${c.description||'Kh√¥ng c√≥ m√¥ t·∫£.'}</p>
    <div class="detail-row"><span class="detail-label">S·∫£n ph·∫©m:</span><span class="detail-val">${c.product||'‚Äî'}</span></div>
    <div class="detail-row"><span class="detail-label">CVSS Score:</span><span class="detail-val" style="color:${col};font-weight:700">${score.toFixed(1)} / 10.0</span></div>
    <div class="detail-row"><span class="detail-label">Vector:</span><span class="detail-val" style="font-family:var(--font-mono);font-size:.75rem">${c.vector||'‚Äî'}</span></div>
    <div class="detail-row"><span class="detail-label">C√¥ng b·ªë:</span><span class="detail-val">${c.published ? new Date(c.published).toLocaleString('vi-VN') : '‚Äî'}</span></div>
    ${(c.references||[]).length ? `<div class="detail-row"><span class="detail-label">Tham kh·∫£o:</span><div><a href="${c.references[0]}" target="_blank" style="color:var(--accent4);font-family:var(--font-mono);font-size:.75rem;word-break:break-all">${c.references[0]}</a></div></div>` : ''}
    <div class="code-block"># Ki·ªÉm tra tr√™n NVD
https://nvd.nist.gov/vuln/detail/${c.id}

# Ki·ªÉm tra b·∫£n v√°
https://nvd.nist.gov/vuln/detail/${c.id}#VulnChangeHistorySection</div>
    <div class="warn-box">‚ö†Ô∏è <strong>Khuy·∫øn ngh·ªã:</strong> C·∫≠p nh·∫≠t ngay l√™n phi√™n b·∫£n ƒë∆∞·ª£c v√°. Theo d√µi th√¥ng b√°o ch√≠nh th·ª©c t·ª´ nh√† cung c·∫•p.</div>`;
  document.getElementById('modalOverlay').classList.add('open');
}

function openNewsModal(idx) {
  const n = newsCache[idx];
  if (!n) return;
  document.getElementById('modalBody').innerHTML = `
    <div style="color:${n.categoryColor||'#4fc3f7'};font-family:var(--font-mono);font-size:.72rem;margin-bottom:.5rem;letter-spacing:1px">${n.category}</div>
    <h2>${n.title}</h2>
    <div class="news-meta" style="margin:1rem 0"><span class="news-src">üì∞ ${n.source}</span><span class="news-date">üïê ${n.date}</span></div>
    <p>${n.summary||'Kh√¥ng c√≥ t√≥m t·∫Øt.'}</p>
    <div style="margin-top:.875rem">${(n.tags||[]).map(t=>`<span class="news-tag" style="margin-right:6px">${t}</span>`).join('')}</div>`;
  document.getElementById('modalOverlay').classList.add('open');
}

function closeModal(e) {
  if (!e || e.target === document.getElementById('modalOverlay'))
    document.getElementById('modalOverlay').classList.remove('open');
}

// ‚îÄ‚îÄ‚îÄ FILTER / SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setFilter(f, btn) {
  currentFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  renderCVETable();
}
function doSearch() {
  currentSearch = document.getElementById('searchInput').value.toLowerCase().trim();
  renderCVETable();
  if (currentSearch) {
    const filtered = newsCache.filter(n =>
      n.title.toLowerCase().includes(currentSearch) ||
      (n.tags||[]).some(t=>t.toLowerCase().includes(currentSearch))
    );
    const backup = newsCache;
    newsCache = filtered.length ? filtered : backup;
    renderNews();
    newsCache = backup;
  } else renderNews();
}

// ‚îÄ‚îÄ‚îÄ COUNTDOWN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startCountdown() {
  secondsLeft = REFRESH_INTERVAL;
  if (countdownTimer) clearInterval(countdownTimer);
  countdownTimer = setInterval(() => {
    secondsLeft--;
    const min = Math.floor(secondsLeft / 60);
    const sec = secondsLeft % 60;
    document.getElementById('countdownNum').textContent = `${min}:${sec.toString().padStart(2,'0')}`;
    const offset = CIRCUMFERENCE - (secondsLeft / REFRESH_INTERVAL * CIRCUMFERENCE);
    document.getElementById('countdownCircle').setAttribute('stroke-dashoffset', offset);
    if (secondsLeft <= 0) {
      clearInterval(countdownTimer);
      addActivity('info', 'T·ª± ƒë·ªông c·∫≠p nh·∫≠t d·ªØ li·ªáu t·ª´ NVD...', 'V·ª´a xong');
      fetchCVEsFromNVD().then(() => startCountdown());
    }
  }, 1000);
}

function manualRefresh() {
  if (countdownTimer) clearInterval(countdownTimer);
  addActivity('info', 'L√†m m·ªõi th·ªß c√¥ng...', 'V·ª´a xong');
  fetchCVEsFromNVD().then(() => startCountdown());
}

// ‚îÄ‚îÄ‚îÄ THEME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleTheme() {
  const html = document.documentElement;
  const isDark = html.dataset.theme === 'dark';
  html.dataset.theme = isDark ? 'light' : 'dark';
  document.getElementById('themeBtn').textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
}

// ‚îÄ‚îÄ‚îÄ MOCK DATA (fallback) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getMockCVEs() {
  const now = new Date();
  const mkDate = (h) => { const d = new Date(now); d.setHours(d.getHours()-h); return d.toISOString(); };
  return [
    { id:'CVE-2025-21298', description:'Windows Object Linking and Embedding (OLE) Remote Code Execution Vulnerability khai th√°c qua email ƒë·ªôc h·∫°i', severity:'CRITICAL', score:9.8, product:'Microsoft Windows', published:mkDate(2), vector:'AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-21298'] },
    { id:'CVE-2025-21333', description:'Windows Hyper-V NT Kernel Integration VSP Elevation of Privilege Vulnerability', severity:'HIGH', score:8.8, product:'Microsoft Hyper-V', published:mkDate(5), vector:'AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-0282', description:'Ivanti Connect Secure stack-based buffer overflow before version 22.7R2.5 cho ph√©p RCE kh√¥ng x√°c th·ª±c', severity:'CRITICAL', score:9.0, product:'Ivanti Connect Secure', published:mkDate(8), vector:'AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H', references:['https://www.ivanti.com/security-advisories'] },
    { id:'CVE-2025-23006', description:'SonicWall SMA 100 series pre-authentication deserialization vulnerability d·∫´n ƒë·∫øn RCE', severity:'CRITICAL', score:9.8, product:'SonicWall SMA', published:mkDate(12), vector:'AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H', references:['https://www.sonicwall.com'] },
    { id:'CVE-2025-21420', description:'Windows Disk Cleanup Tool Elevation of Privilege Vulnerability', severity:'HIGH', score:7.8, product:'Microsoft Windows', published:mkDate(18), vector:'AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-1094', description:'PostgreSQL quoting APIs fail to account for invalid multibyte characters, c√≥ th·ªÉ d·∫´n ƒë·∫øn SQL injection', severity:'HIGH', score:8.1, product:'PostgreSQL', published:mkDate(24), vector:'AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H', references:['https://www.postgresql.org/support/security'] },
    { id:'CVE-2025-20156', description:'Cisco Meeting Management REST API Privilege Escalation Vulnerability', severity:'CRITICAL', score:9.9, product:'Cisco Meeting Management', published:mkDate(36), vector:'AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H', references:['https://sec.cloudapps.cisco.com'] },
    { id:'CVE-2025-21293', description:'Active Directory Domain Services Elevation of Privilege Vulnerability', severity:'HIGH', score:8.8, product:'Microsoft Active Directory', published:mkDate(48), vector:'AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-21362', description:'Microsoft Excel Remote Code Execution Vulnerability qua file .xlsx ƒë·ªôc h·∫°i', severity:'HIGH', score:7.8, product:'Microsoft Excel', published:mkDate(56), vector:'AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-21354', description:'Microsoft Excel Remote Code Execution Vulnerability ‚Äî con ƒë∆∞·ªùng khai th√°c kh√°c', severity:'HIGH', score:7.8, product:'Microsoft Excel', published:mkDate(60), vector:'AV:L/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-21378', description:'Windows CSC Service Elevation of Privilege Vulnerability', severity:'HIGH', score:7.8, product:'Microsoft Windows CSC', published:mkDate(72), vector:'AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H', references:['https://msrc.microsoft.com'] },
    { id:'CVE-2025-21374', description:'Windows CSC Service Information Disclosure Vulnerability', severity:'MEDIUM', score:5.5, product:'Microsoft Windows', published:mkDate(84), vector:'AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N', references:['https://msrc.microsoft.com'] },
  ];
}

function getMockNews() {
  return [
    { id:1, category:'APT', categoryColor:'#ff3a3a', title:'Salt Typhoon ti·∫øp t·ª•c nh·∫Øm v√†o c∆° s·ªü h·∫° t·∫ßng vi·ªÖn th√¥ng M·ªπ v√† Ch√¢u √Å', source:'The Hacker News', date:new Date().toLocaleDateString('vi-VN'), tags:['APT','China','Telecom'], urgent:true, summary:'Nh√≥m APT do nh√† n∆∞·ªõc Trung Qu·ªëc h·ªó tr·ª£ Salt Typhoon v·∫´n ƒëang ho·∫°t ƒë·ªông m·∫°nh m·∫Ω, nh·∫Øm v√†o c√°c nh√† cung c·∫•p d·ªãch v·ª• vi·ªÖn th√¥ng. C√°c c∆° quan t√¨nh b√°o M·ªπ ƒë√£ c·∫£nh b√°o v·ªÅ quy m√¥ ch∆∞a t·ª´ng c√≥ c·ªßa chi·∫øn d·ªãch n√†y.' },
    { id:2, category:'Ransomware', categoryColor:'#f5a623', title:'Clop ransomware khai th√°c l·ªó h·ªïng zero-day trong ph·∫ßn m·ªÅm chuy·ªÉn file Cleo', source:'BleepingComputer', date:new Date().toLocaleDateString('vi-VN'), tags:['Ransomware','Clop','Zero-day'], urgent:false, summary:'Nh√≥m ransomware Clop ƒëang t√≠ch c·ª±c khai th√°c c√°c l·ªó h·ªïng trong ph·∫ßn m·ªÅm chuy·ªÉn file doanh nghi·ªáp Cleo, ·∫£nh h∆∞·ªüng ƒë·∫øn h√†ng ch·ª•c t·ªï ch·ª©c to√†n c·∫ßu.' },
    { id:3, category:'Vulnerability', categoryColor:'#4fc3f7', title:'CISA b·ªï sung 3 l·ªó h·ªïng m·ªõi v√†o danh s√°ch KEV ‚Äî V√° ngay tr∆∞·ªõc 7/3/2025', source:'CISA', date:new Date().toLocaleDateString('vi-VN'), tags:['CISA','KEV','Patch'], urgent:true, summary:'CISA ƒë√£ th√™m ba l·ªó h·ªïng m·ªõi v√†o Known Exploited Vulnerabilities catalog, y√™u c·∫ßu c√°c c∆° quan li√™n bang M·ªπ v√° tr∆∞·ªõc ng√†y 7/3/2025.' },
    { id:4, category:'Malware', categoryColor:'#00f5c4', title:'Malware FinalDraft ·∫©n trong Microsoft Graph API ‚Äî Ph√¢n t√≠ch k·ªπ thu·∫≠t', source:'Elastic Security', date:new Date().toLocaleDateString('vi-VN'), tags:['Malware','APT','C2'], urgent:false, summary:'C√°c nh√† nghi√™n c·ª©u ph√°t hi·ªán malware FinalDraft s·ª≠ d·ª•ng Microsoft Graph API l√†m k√™nh C2, khi·∫øn traffic h√≤a l·∫´n v√†o l∆∞u l∆∞·ª£ng Microsoft 365 h·ª£p l·ªá.' },
    { id:5, category:'Phishing', categoryColor:'#ff3a3a', title:'Chi·∫øn d·ªãch phishing gi·∫£ m·∫°o DeepSeek AI ƒëang ph√°t t√°n malware to√†n c·∫ßu', source:'SecurityWeek', date:new Date().toLocaleDateString('vi-VN'), tags:['Phishing','AI','Infostealer'], urgent:false, summary:'K·∫ª t·∫•n c√¥ng ƒëang l·ª£i d·ª•ng s·ª± ph·ªï bi·∫øn c·ªßa AI DeepSeek ƒë·ªÉ t·∫°o c√°c trang web gi·∫£ m·∫°o, l·ª´a ng∆∞·ªùi d√πng t·∫£i xu·ªëng infostealer.' },
  ];
}

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
addActivity('info', 'H·ªá th·ªëng CyberWatch VN kh·ªüi ƒë·ªông', 'V·ª´a xong');
addActivity('info', 'K·∫øt n·ªëi t·ªõi NVD API (nvd.nist.gov)...', 'V·ª´a xong');
fetchCVEsFromNVD().then(() => startCountdown());
</script>
</body>
</html>